<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Math Champs - Adaptive Test</title>
    
    <!-- Font 'Nunito' & 'Noto Sans' -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Noto+Sans:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- KaTeX untuk Rumus Matematika Cantik -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <style>
        :root {
            --primary: #FF9F1C; 
            --primary-dark: #e08b15;
            --secondary: #2EC4B6;
            --secondary-dark: #259f93;
            --accent: #E71D36;
            --dark: #011627;
            --light: #FDFFFC;
            --bg-gradient: linear-gradient(135deg, #E0F7FA 0%, #80DEEA 100%);
            --header-bg: #011627;
            --text-main: #2c3e50;
            
            /* Singapore Math Palette */
            --mainblue: #006EBE;
            --softblue: #EBF5FF;
            --maingreen: #28B464;
            --softgreen: #EBFAF0;
            --mainred: #DC3C32;
            --softred: #FFF0F0;
            --honeyyellow: #FFC832;
            --honeysoft: #FFF5D2;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- GLOBAL LAYOUT --- */
        html { height: 100%; }

        body {
            font-family: 'Nunito', sans-serif;
            background: var(--bg-gradient);
            margin: 0;
            padding: 0;
            color: var(--text-main);
            height: 100%;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            width: 100vw;
            background-image: 
                radial-gradient(#2EC4B6 1px, transparent 1px), 
                radial-gradient(#2EC4B6 1px, transparent 1px);
            background-position: 0 0, 25px 25px;
            background-size: 50px 50px;
            background-color: #f0f8ff;
        }

        /* --- HEADER --- */
        header {
            background: var(--header-bg);
            padding: 15px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            z-index: 50;
            position: relative;
            flex-shrink: 0; 
            height: 80px;
        }

        .logo {
            height: 40px;
            object-fit: contain;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
            display: block; 
        }

        .status-bar {
            display: flex;
            gap: 15px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.15);
            padding: 10px 20px; 
            border-radius: 50px;
            font-weight: 800;
            color: white;
            font-size: 1.2rem; 
            border: 2px solid rgba(255,255,255,0.2);
        }
        
        /* --- DESKTOP LAYOUT (IMMERSIVE) --- */
        @media (min-width: 769px) {
            body { overflow: hidden; }
            .app-container { height: 100vh; }
            .game-stage {
                flex: 1;
                overflow-y: auto; 
                padding: 20px;
                display: flex;
                justify-content: center;
                scrollbar-width: thin;
            }
            .content-card {
                margin: auto 0;
                max-width: 900px;
                background: rgba(255, 255, 255, 0.95);
                border-radius: 24px;
                padding: 40px;
                box-shadow: 0 10px 40px rgba(1, 22, 39, 0.1);
                animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                width: 100%;
            }
            .feedback-container {
                margin-top: 30px;
                display: none; 
                flex-direction: column;
                align-items: center;
                animation: popIn 0.3s ease;
            }
        }

        /* --- MOBILE LAYOUT (SCROLL FIX) --- */
        @media (max-width: 768px) {
            body { overflow-y: auto; height: auto; }
            html { height: auto; }
            .app-container { height: auto; min-height: 100vh; background-size: 20px 20px; }
            header { position: sticky; top: 0; padding: 12px 20px; justify-content: space-between; }
            .game-stage { display: block; height: auto; padding: 0; overflow: visible; }
            .content-card {
                background: white;
                max-width: none;
                border-radius: 0;
                box-shadow: none;
                margin: 0;
                min-height: calc(100vh - 80px); 
                padding: 25px 20px 150px 20px; 
            }
            h1 { font-size: 1.6rem !important; }
            .question-box { font-size: 1.1rem !important; }
            .feedback-container {
                position: fixed; bottom: 0; left: 0; right: 0;
                background: white; padding: 20px;
                box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
                animation: slideUp 0.3s ease;
                border-top: 1px solid #eee;
                display: none; 
                flex-direction: column; align-items: center;
                z-index: 100;
            }
        }

        /* --- ANIMATIONS & COMMON --- */
        @keyframes popIn {
            from { opacity: 0; transform: scale(0.95) translateY(20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        h1 {
            color: var(--primary); font-weight: 900; font-size: 2.2rem;
            margin: 0 0 10px 0; text-transform: uppercase; letter-spacing: -0.5px;
        }

        h2 { color: #7f8c8d; font-weight: 600; margin: 0; }

        /* INPUT FIELD STYLES */
        .input-group { margin-bottom: 25px; text-align: left; width: 100%; max-width: 400px; margin-left: auto; margin-right: auto; }
        .input-label { display: block; font-weight: 700; margin-bottom: 10px; color: var(--dark); font-size: 1.1rem; }
        .name-input {
            width: 100%; padding: 15px 20px; font-size: 1.2rem;
            border: 2px solid #e0e6ed; border-radius: 15px;
            font-family: 'Nunito', sans-serif; outline: none; transition: border-color 0.2s;
            background: white; /* Ensure select has background */
        }
        .name-input:focus { border-color: var(--primary); }

        .progress-container {
            background: #eef2f5; height: 14px; border-radius: 50px;
            margin: 0 0 30px; overflow: hidden;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), #ffcb05);
            width: 0%; border-radius: 50px;
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .question-box {
            font-size: 1.35rem; font-weight: 700; color: var(--dark);
            margin-bottom: 30px; line-height: 1.5;
        }

        .q-img {
            max-width: 100%; border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin: 20px 0; border: 4px solid #fff;
        }
        
        .opt-img { max-height: 80px; object-fit: contain; pointer-events: none; }

        .options-grid {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;
        }

        @media (max-width: 600px) {
            .options-grid { grid-template-columns: 1fr; }
        }

        .option-btn {
            background: white;
            border: 2px solid #e0e6ed; border-bottom: 6px solid #e0e6ed;
            padding: 20px; border-radius: 20px;
            font-size: 1.1rem; color: var(--text-main); font-weight: 700;
            cursor: pointer; transition: all 0.15s ease;
            position: relative; font-family: 'Nunito', sans-serif;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }

        .option-btn:hover:not(:disabled) {
            border-color: var(--secondary); border-bottom-color: var(--secondary-dark);
            background: #f0fffd; transform: translateY(-2px);
        }
        .option-btn:active:not(:disabled) {
            transform: translateY(4px); border-bottom-width: 2px; margin-top: 4px;
        }
        .option-btn:disabled { opacity: 0.8; cursor: default; }

        .option-btn.correct {
            background: #d1f7c4; border-color: #2ecc71; border-bottom-color: #27ae60; color: #27ae60;
        }
        .option-btn.wrong {
            background: #fadbd8; border-color: #e74c3c; border-bottom-color: #c0392b; color: #c0392b;
        }
        
        /* Report variant */
        .option-btn.report-variant {
            padding: 15px; font-size: 1rem; min-height: auto;
            border-bottom-width: 3px; cursor: default; pointer-events: none;
        }
        .report-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; width: 100%; }
        @media(max-width: 600px) { .report-grid { grid-template-columns: 1fr !important; } }

        .btn {
            background: var(--primary); color: white; border: none;
            border-bottom: 5px solid var(--primary-dark);
            padding: 18px 40px; font-size: 1.2rem; border-radius: 50px;
            font-weight: 800; cursor: pointer; transition: all 0.1s;
            font-family: 'Nunito', sans-serif; text-transform: uppercase; letter-spacing: 1px;
            display: inline-block; margin-top: 20px; width: 100%;
        }
        .btn:active { transform: translateY(3px); border-bottom-width: 2px; margin-top: 23px; }
        .btn-next { background: var(--secondary); border-bottom: 5px solid var(--secondary-dark); }
        .btn-report { background: white; color: var(--dark); border: 2px solid #ddd; border-bottom: 5px solid #ccc; margin-top: 15px; }
        .btn-report:active { border-bottom-width: 2px; margin-top: 18px; }
        .btn-dashboard { background: #34495e; border-bottom: 5px solid #2c3e50; font-size: 0.9rem; margin-top: 10px; width: auto; padding: 10px 20px; }

        .feedback-msg { font-size: 1.4rem; font-weight: 800; margin-bottom: 15px; }
        
        /* Checkpoint Overlay */
        .checkpoint-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(1, 22, 39, 0.9); z-index: 200;
            display: none; justify-content: center; align-items: center;
            flex-direction: column; animation: fadeIn 0.3s ease; backdrop-filter: blur(5px);
        }
        .checkpoint-content {
            background: white; padding: 40px; border-radius: 30px;
            text-align: center; max-width: 400px; width: 90%;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            animation: zoomIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative; overflow: hidden;
        }
        .checkpoint-content::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 10px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        /* Report Card */
        .report-card {
            display: none; margin-top: 30px; text-align: left;
            background: #fff; border-radius: 15px; border: 2px solid #eee;
            overflow: hidden; animation: slideUp 0.3s ease;
        }
        .report-header { background: var(--dark); color: white; padding: 15px 20px; font-weight: 800; font-size: 1.1rem; }
        .report-list { padding: 0; margin: 0; list-style: none; max-height: 500px; overflow-y: auto; }
        .report-item { padding: 25px 20px; border-bottom: 4px solid #f0f4f8; font-size: 0.95rem; }
        .report-item:last-child { border-bottom: none; }
        .report-meta { display: inline-block; background: #e3f2fd; color: #1565c0; padding: 3px 10px; border-radius: 15px; font-size: 0.75rem; font-weight: 800; margin-bottom: 15px; text-transform: uppercase; }
        .report-q-text { margin-bottom: 20px; font-weight: 700; color: var(--dark); font-size: 1.1rem; }
        .report-q-text img { max-width: 100%; height: auto; max-height: 200px; display: block; margin: 10px 0; border-radius: 8px; border: 1px solid #eee; }

        .screen { display: none; width: 100%; }
        .screen.active { display: block; }
        
        .result-level { font-size: clamp(2rem, 8vw, 3.5rem); font-weight: 900; color: white; text-shadow: 2px 2px 0 rgba(0,0,0,0.1); word-wrap: break-word; line-height: 1.1; }
        .result-card-inner {
            background: linear-gradient(135deg, #FF9F1C, #FF5E00);
            padding: 40px; border-radius: 30px; color: white; margin: 20px 0;
            position: relative; overflow: hidden; box-shadow: 0 15px 30px rgba(255, 159, 28, 0.4);
        }
        .result-card-inner::before {
            content: 'üèÜ'; position: absolute; font-size: 10rem; opacity: 0.1;
            right: -20px; bottom: -20px; transform: rotate(-15deg);
        }
    </style>
</head>
<body>

<div class="app-container">
    <!-- HEADER -->
    <header>
        <img src="https://imgix3.ruangguru.com/assets/miscellaneous/png_aaojxe_9962.png" alt="Math Champs" class="logo">
        <div class="status-bar" id="statusBar" style="visibility: hidden;">
            <!-- Timer (Sekarang Hidden) -->
            <div class="status-item" style="display: none;">
                <span>‚è±Ô∏è</span> <span id="timerDisplay">60:00</span>
            </div>
        </div>
    </header>

    <!-- MAIN GAME STAGE -->
    <div class="game-stage">
        <div class="content-card">
            
            <!-- SCREEN 0: INPUT NAME & CLASS -->
            <div id="inputNameScreen" class="screen active" style="text-align: center;">
                <div style="font-size: 4rem; margin-bottom: 10px;">üëã</div>
                <h1>Halo, Champion!</h1>
                <h2 style="margin-bottom: 40px;">Lengkapi data dirimu</h2>
                
                <div class="input-group">
                    <label class="input-label">Nama Lengkap</label>
                    <input type="text" id="studentNameInput" class="name-input" placeholder="Tulis namamu di sini..." autocomplete="off">
                </div>

                <div class="input-group">
                    <label class="input-label">Kelas</label>
                    <select id="studentClassInput" class="name-input">
                        <option value="1">Kelas 1</option>
                        <option value="2">Kelas 2</option>
                        <option value="3">Kelas 3</option>
                        <option value="4">Kelas 4</option>
                        <option value="5">Kelas 5</option>
                        <option value="6">Kelas 6</option>
                        <option value="7">Kelas 7</option>
                        <option value="8">Kelas 8</option>
                        <option value="9">Kelas 9</option>
                    </select>
                </div>

                <button class="btn" onclick="saveNameAndContinue()">Lanjut</button>
            </div>

            <!-- SCREEN 1: START -->
            <div id="startScreen" class="screen" style="text-align: center;">
                <div style="font-size: 4rem; margin-bottom: 10px;">ü§ñ</div>
                <h1>Tes Adaptif</h1>
                <h2 style="margin-bottom: 30px;">Sistem Cerdas Math Champs</h2>

                <div style="background: #FFF8E1; padding: 25px; border-radius: 20px; text-align: left; border: 2px solid #FFE082; margin-bottom: 30px;">
                    <h3 style="margin: 0 0 15px 0; color: #F57F17;">üìú Cara Kerja Tes:</h3>
                    <ul style="margin: 0; padding-left: 20px; color: #5d4037; font-size: 1.1rem; line-height: 1.6;">
                        <li>Tes dimulai dari <strong>Level Tengah</strong>.</li>
                        <li>Sistem akan menyesuaikan soal menjadi lebih mudah/sulit berdasarkan jawabanmu.</li>
                        <li><strong>Fitur Pintar:</strong> Jika kamu salah 2x dalam satu level, tes akan langsung menyesuaikan (tidak perlu menunggu 5 soal).</li>
                    </ul>
                </div>

                <button class="btn" onclick="startGame()">Mulai Sekarang üöÄ</button>
            </div>

            <!-- SCREEN 2: GAME -->
            <div id="gameScreen" class="screen">
                <div class="progress-container">
                    <div class="progress-fill" id="progressBar"></div>
                </div>
                <div class="question-box" id="questionText"></div>
                <div class="options-grid" id="optionsContainer"></div>
            </div>

            <!-- SCREEN 3: RESULT -->
            <div id="resultScreen" class="screen" style="text-align: center;">
                <h1>Tes Selesai! üéâ</h1>
                <p style="font-size: 1.2rem; color: #7f8c8d;">Level kamu sudah ditemukan!</p>
                <div class="result-card-inner">
                    <div style="font-size: 1rem; opacity: 0.9; text-transform: uppercase; letter-spacing: 2px;">Level Rekomendasi</div>
                    <div class="result-level" id="finalPlacement">...</div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 30px;">
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; border: 2px solid #eee;">
                        <div style="font-size: 2rem; font-weight: 900; color: var(--dark);" id="finalScore">0</div>
                        <div style="color: #95a5a6; font-size: 0.9rem; font-weight: 700;">TOTAL BENAR</div>
                    </div>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; border: 2px solid #eee;">
                        <div style="font-size: 2rem; font-weight: 900; color: var(--dark);" id="timeUsed">00:00</div>
                        <div style="color: #95a5a6; font-size: 0.9rem; font-weight: 700;">WAKTU</div>
                    </div>
                </div>
                <button class="btn btn-report" onclick="toggleReport()" id="btnReportToggle">üìã Lihat Detail Jawaban Salah</button>
                <button class="btn btn-dashboard" onclick="clearAndReload()" style="background: #e74c3c; border-bottom-color: #c0392b;">üîÑ Reset & Main Lagi</button>
                
                <div id="reportCard" class="report-card">
                    <div class="report-header">
                        <span>Analisis Kesalahan</span>
                    </div>
                    <ul id="reportList" class="report-list"></ul>
                </div>
            </div>
            
            <!-- FEEDBACK AREA -->
            <div class="feedback-container" id="feedbackArea">
                <div class="feedback-msg" id="feedbackMessage">Jawaban Benar!</div>
                <button class="btn btn-next" id="nextBtn">Lanjut ‚ûî</button>
            </div>
            
            <!-- CHECKPOINT MODAL -->
            <div id="checkpointModal" class="checkpoint-overlay">
                <div class="checkpoint-content">
                    <div style="font-size: 4rem; margin-bottom: 10px;">‚öñÔ∏è</div>
                    <h2 style="color: var(--primary); font-size: 1.8rem; margin-bottom: 10px;">ANALISIS SELESAI</h2>
                    <p style="font-size: 1.1rem; color: #555;">Kami sedang menyesuaikan tingkat kesulitan soal...</p>
                    <p id="checkpointMsg" style="color: #27ae60; font-weight: bold; margin: 15px 0;">...</p>
                    <button class="btn" onclick="closeCheckpoint()">LANJUT ‚ñ∂</button>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
    // 1. DATA SOAL (60 Soal)
    const questions = [
        // --- Discovery 1 (Soal 1-5) ---
        { level: "Discovery 1", text: "Perhatikan gambar bola voli dan bola basket di bawah ini.<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_fexpep_4306.png' class='q-img'><br>Pilih pernyataan yang <strong>benar</strong> sesuai gambar di atas:", options: ["\\( 4 > 9 \\)", "Bola basket berjumlah 6 bola <strong>lebih banyak</strong> dari jumlah bola voli", "Bola voli berjumlah 5 bola <strong>lebih sedikit</strong> dari jumlah bola basket", "Jumlah bola basket dan bola voli adalah 14", "Jumlah bola basket lebih sedikit dari jumlah bola voli"], answer: 2 },
        { level: "Discovery 1", text: "15 anak sedang berbaris dalam sebuah antrean untuk membeli es krim. Diketahui ada <strong>9 anak di belakang Ron</strong>. Ron berada pada <strong>urutan keberapa</strong> dari depan?", options: ["Ke-5", "Ke-6", "Ke-7", "Ke-8", "Ke-9"], answer: 1 },
        { level: "Discovery 1", text: "Gambar-gambar di bawah ini menunjukkan contoh ikatan bilangan (<em>number bonds</em>).<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_anvga6_4974.png' class='q-img'><br>Diberikan ikatan bilangan berantai di bawah ini. Berapakah <strong>nilai</strong> dari simbol bintang (\\(\\star\\))?<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_a11kd9_2047.png' class='q-img'>", options: ["1", "2", "3", "4", "5"], answer: 1 },
        { level: "Discovery 1", text: "Perhatikan gambar 4 buah penjepit kertas pada grid satuan di bawah ini.<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_1ubn5q_2922.png' class='q-img'><br>Berapakah <strong>selisih panjang</strong> penjepit terpanjang dengan penjepit terpendek?", options: ["2 satuan", "3 satuan", "4 satuan", "5 satuan", "6 satuan"], answer: 2 },
        { level: "Discovery 1", text: "Di lapangan, jumlah anak laki-laki <strong>5 lebih sedikit</strong> dari jumlah anak perempuan. Setelah 2 anak laki-laki pulang ke rumah, <strong>tersisa 3</strong> anak laki-laki di lapangan.<br><br>Ada <strong>berapa anak perempuan</strong> yang sedang berada di lapangan?", options: ["5 anak", "8 anak", "10 anak", "12 anak", "13 anak"], answer: 2 },
        // --- Discovery 2 (Soal 6-10) ---
        { level: "Discovery 2", text: "Manakah dari pilihan di bawah ini yang memiliki nilai atau jumlah <strong>terbesar</strong>?", options: ["<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_urtpbk_3465.png' class='opt-img'>", "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_f3sobk_1201.png' class='opt-img'>", "23", "1 puluhan, 15 satuan", "2 puluhan, 1 satuan"], answer: 3 },
        { level: "Discovery 2", text: "Joan membeli 3 ekor ikan hias.<br>Robin membeli 2 ekor ikan hias <strong>lebih banyak</strong> dari Joan.<br>Doni membeli 5 ekor ikan hias <strong>lebih banyak</strong> dari Robin.<br><br>Berapa banyak <strong>jumlah total</strong> semua ikan hias milik Joan, Robin, dan Doni?", options: ["15 ekor", "16 ekor", "17 ekor", "18 ekor", "20 ekor"], answer: 3 },
        { level: "Discovery 2", text: "Beni tidur pada pukul 23:00 dan bangun keesokan harinya pada pukul 07:30. <strong>Berapa lama</strong> Beni tertidur?<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_wgydzu_7105.png' class='q-img'>", options: ["7 jam", "7 jam 30 menit", "8 jam", "8 jam 30 menit", "9 jam"], answer: 3 },
        { level: "Discovery 2", text: "Manakah gambar atau simbol yang memiliki arti <strong>berbeda</strong> dari yang lain (Perhatikan konsep pengelompokannya)?", options: ["<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_covtau_4848.png' class='opt-img'>", "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_nsafji_6424.png' class='opt-img'>", "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_drewgx_9962.png' class='opt-img'>", "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_a20nsj_4422.png' class='opt-img'>", "\\( 4 \\times 3 = 12 \\)"], answer: 0 },
        { level: "Discovery 2", text: "Perhatikan data perolehan bintang siswa berikut ini.<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_6hjnfz_2336.png' class='q-img'><br>Berapakah <strong>total poin</strong> yang didapatkan <strong>Evelyn</strong>?", options: ["3 poin", "10 poin", "15 poin", "20 poin", "25 poin"], answer: 2 },
        // --- Discovery 3 (Soal 11-15) ---
        { level: "Discovery 3", text: "Perhatikan dua kelompok blok di bawah ini.<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_m8yxwf_8364.png' class='q-img'><br>Hitunglah <strong>selisih nilai</strong> antara kedua kelompok blok di atas.", options: ["126", "136", "146", "236", "246"], answer: 1 },
        { level: "Discovery 3", text: "Rara memiliki <strong>3 balon lebih banyak</strong> dari Riri. Jumlah semua balon Rara dan Riri adalah <strong>11 balon</strong>.<br><br>Berapa banyak balon yang <strong>dimiliki Rara</strong>?", options: ["4 balon", "5 balon", "6 balon", "7 balon", "8 balon"], answer: 3 },
        { level: "Discovery 3", text: "Tinggi badan kakak adalah 1 meter 36 centimeter.<br>Tinggi badan adik adalah 51 centimeter.<br><br>Berapa <strong>selisih</strong> tinggi badan kakak dan adik?", options: ["75 cm", "85 cm", "95 cm", "105 cm", "187 cm"], answer: 1 },
        { level: "Discovery 3", text: "Perhatikan pola gambar berikut:<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_42rsk7_6010.png' class='q-img'><br>Gambar apakah yang akan muncul pada <strong>urutan ke-20 dan ke-30</strong>?", options: ["<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_vx2vxq_202.png' class='opt-img'>", "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_7403fz_1901.png' class='opt-img'>", "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_shnwi5_7897.png' class='opt-img'>", "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_2nqwr3_6.png' class='opt-img'>", "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_nbp4oc_6208.png' class='opt-img'>"], answer: 1 },
        { level: "Discovery 3", text: "Sharon memiliki 25 buah mangga. Sharon membagikan <strong>sebanyak-banyaknya</strong> mangga tersebut kepada 3 adiknya <strong>sama banyak</strong>. Pilih jawaban yang tepat mengenai jumlah buah mangga milik Sharon dan adik-adiknya setelah pembagian.", options: ["Sharon: 1 mangga, masing-masing adiknya: 8 mangga", "Sharon: 2 mangga, masing-masing adiknya: 8 mangga", "Sharon: 4 mangga, masing-masing adiknya: 7 mangga", "Sharon: 1 mangga, masing-masing adiknya: 3 mangga", "Sharon: 7 mangga, masing-masing adiknya: 6 mangga"], answer: 0 },
        // --- Discovery 4 (Soal 16-20) ---
        { level: "Discovery 4", text: "Manakah gambar yang menunjukkan nilai pecahan yang <strong>berbeda</strong> dari yang lainnya?<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_sfyx5q_6217.png' class='q-img'>", options: ["Gambar A", "Gambar B", "Gambar C", "Gambar D", "Gambar E"], answer: 3 },
        { level: "Discovery 4", text: "Hitunglah <strong>jumlah total</strong> dari kumpulan bilangan pada susunan sarang lebah berikut ini.<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_ftwbr3_4258.png' class='q-img'>", options: ["61", "68", "70", "71", "72"], answer: 3 },
        { level: "Discovery 4", text: "Berapakah <strong>selisih</strong> jumlah <strong>sisi</strong> dengan jumlah <strong>titik sudut</strong> pada sebuah limas segiempat?<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_miyzft_675.png' class='q-img'>", options: ["0", "1", "2", "3", "4"], answer: 0 },
        { level: "Discovery 4", text: "Bilangan yang tepat untuk melengkapi kalimat matematika di bawah ini adalah...<br><br>\\[ 16 + 12 - \\underline{\\hspace{1cm}} + 14 = 35 \\]", options: ["5", "6", "7", "8", "9"], answer: 2 },
        { level: "Discovery 4", text: "Hendro memiliki:<br><ul><li>2 lembar Rp10.000</li><li>3 lembar Rp5.000</li><li>4 lembar Rp2.000</li><li>5 lembar Rp1.000</li></ul><br>Ada berapa banyak cara untuk membayar topi seharga <strong>Rp14.000</strong> dengan <strong>uang pas</strong>?", options: ["6 cara", "7 cara", "8 cara", "9 cara", "10 cara"], answer: 3 },
        // --- Exploration 1 (Soal 21-25) ---
        { level: "Exploration 1", text: "Diberikan 5 angka berikut ini: 6, 1, 8, 3, 9.<br><br>Berapakah bilangan <strong>genap 4 digit terbesar</strong> yang dapat dibentuk dari angka-angka yang diberikan di atas?", options: ["9863", "9836", "9638", "9816", "9986"], answer: 1 },
        { level: "Exploration 1", text: "Tuliskan bilangan yang tepat untuk melengkapi kalimat matematika di bawah ini.<br><br>\\[ 4 \\times 11 + \\_\\_\\_ = 54 \\]", options: ["8", "9", "10", "11", "12"], answer: 2 },
        { level: "Exploration 1", text: "Panjang sebuah jalan raya adalah 2 kilometer 400 meter. Ibu walikota berencana untuk menanamkan pohon dari <strong>satu ujung jalan ke ujung jalan yang lain</strong>. Jika <strong>jarak antar pohon</strong> adalah 300 meter, ada berapa pohon yang ditanam oleh ibu walikota?", options: ["7 pohon", "8 pohon", "9 pohon", "10 pohon", "12 pohon"], answer: 2 },
        { level: "Exploration 1", text: "Tuliskan bilangan yang tepat untuk melengkapi kalimat matematika di bawah ini.<br><br>\\[ 2 \\times 36 : \\_\\_\\_ = 12 \\]", options: ["4", "5", "6", "8", "9"], answer: 2 },
        { level: "Exploration 1", text: "Perhatikan diagram batang (tidak lengkap) di bawah ini.<br><strong>Data Penjualan Laptop Toko iGloo</strong><br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_d8cgnc_5445.png' class='q-img'><br>Diketahui bahwa:<br><ul><li>Laptop yang terjual pada bulan Februari dua kali lebih banyak dibandingkan dengan laptop yang terjual pada bulan Januari.</li><li>Penjualan pada bulan Maret 30 laptop lebih sedikit dari bulan Februari.</li></ul><br>Berapakah <strong>jumlah semua</strong> laptop yang terjual pada bulan Januari sampai Maret?", options: ["150", "180", "195", "210", "225"], answer: 2 },
        // --- Exploration 2 (Soal 26-30) ---
        { level: "Exploration 2", text: "Jumlah penonton konser adalah 4.582 orang. Panitia konser mencatat jumlah penonton konser tersebut dengan <strong>pembulatan ke ratusan terdekat</strong>. Tuliskan lambang bilangan yang dicatat oleh panitia konser.", options: ["4.500", "4.580", "4.600", "4.700", "5.000"], answer: 2 },
        { level: "Exploration 2", text: "Perhatikan gambar di bawah ini.<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_x0ndvk_8478.png' class='q-img'><br>Pilih operasi pecahan yang <strong>tidak sesuai</strong> dengan gambar di atas.", options: ["\\(\\frac{3}{6} + \\frac{2}{6} = \\frac{5}{6}\\)", "\\(\\frac{1}{3} + \\frac{1}{2} = \\frac{5}{6}\\)", "\\(\\frac{1}{2} + \\frac{1}{3} = \\frac{5}{6}\\)", "\\(\\frac{1}{6} + \\frac{2}{3} = \\frac{5}{6}\\)", "\\(\\frac{4}{12} + \\frac{6}{12} = \\frac{10}{12}\\)"], answer: 3 },
        { level: "Exploration 2", text: "Perhatikan gambar dua persegi di bawah ini.<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_mdffvd_6624.png' class='q-img'><br>Diketahui panjang sisi Persegi B <strong>dua kali lebih panjang</strong> dari sisi Persegi A.<br><br><strong>Luas</strong> Persegi B adalah ___ satuan luas.", options: ["18", "27", "36", "45", "81"], answer: 2 },
        { level: "Exploration 2", text: "Kelas 3A terdiri dari 27 siswa. Jika \\(\\frac{2}{3}\\) dari seluruh kelas adalah penggemar Shakira, berapa siswa kelas 3A yang <strong>bukan penggemar</strong> Shakira?", options: ["6 siswa", "9 siswa", "12 siswa", "18 siswa", "21 siswa"], answer: 1 },
        { level: "Exploration 2", text: "Perhatikan diagram batang di bawah ini.<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_udqk91_9125.png' class='q-img'><br>Berapa <strong>selisih</strong> jumlah pengunjung mal pada hari pengunjung <strong>paling banyak</strong> dengan pada hari pengunjung <strong>paling sedikit</strong>?", options: ["200 pengunjung", "240 pengunjung", "280 pengunjung", "300 pengunjung", "320 pengunjung"], answer: 2 },
        // --- Exploration 3 (Soal 31-35) ---
        { level: "Exploration 3", text: "Aku adalah bilangan <strong>kelipatan 4</strong>. Aku memiliki <strong>5 faktor</strong>. Bilangan apakah aku?", options: ["8", "12", "16", "20", "24"], answer: 2 },
        { level: "Exploration 3", text: "Perhatikan gambar di bawah ini.<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_mrykua_3248.png' class='q-img'><br>Pilih pernyataan yang <strong>TIDAK SESUAI</strong> dengan gambar di atas.", options: ["\\( 3 \\times 6 = 18 \\)", "\\( 3 \\times (2 + 4) = 18 \\)", "\\( 3 \\times 2 + 3 \\times 4 = 18 \\)", "\\( 5 \\times 3 + 1 \\times 3 = 18 \\)", "\\( 3 \\times (4 + 2) = 18 \\)"], answer: 3 },
        { level: "Exploration 3", text: "Nena membeli kelereng dari dua toko: Toko A dan Toko B.<br><ul><li>Toko A menjual kelereng dalam satuan kodi (20 buah).</li><li>Toko B menjual kelereng dalam satuan lusin (12 buah).</li></ul><br>Nena membeli 3 kodi dari toko A dan 4 lusin dari toko B.<br>Berapa <strong>jumlah kelereng</strong> yang Nena beli?", options: ["48 butir", "60 butir", "100 butir", "108 butir", "112 butir"], answer: 3 },
        { level: "Exploration 3", text: "Perhatikan proses perkalian vertikal di bawah ini.<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_tciz5u_9051.png' class='q-img'><br>Dari pilihan di bawah ini, pilihan mana yang <strong>TIDAK SESUAI</strong> dengan proses perkalian vertikal di atas?", options: ["<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_zyvatm_5236.png' class='opt-img' style='max-height: 200px;'>", "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_2ihh7f_7988.png' class='opt-img' style='max-height: 200px;'>", "\\( 35 \\times 12 = 70 \\times 6 = 420 \\)", "\\( 35 \\times 12 = 35 \\times (10 + 2) = 35 \\times 10 + 35 \\times 2 = 350 + 70 = 420 \\)", "\\( 35 \\times 12 = 35 \\times (1 \\text{ puluhan} + 2 \\text{ satuan}) = 35 \\text{ puluhan} + 70 \\text{ satuan} = 420 \\)"], answer: 2 },
        { level: "Exploration 3", text: "Perhatikan proses pembagian vertikal di bawah ini.<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_vbusm7_752.png' class='q-img'><br>Dari pilihan di bawah ini, pilihan mana yang <strong>TIDAK SESUAI</strong> dengan proses pembagian vertikal di atas?", options: ["5 ratusan, 5 puluhan, 4 satuan dibagi 4", "\\( 552 : 4 = (500 + 50 + 2) : 4 = 500 : 4 + 50 : 4 + 2 : 4 = 400 : 4 + 120 : 4 + 32 : 4 = 100 + 30 + 8 = 138 \\)", "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_pjcy5p_2842.png' class='opt-img' style='max-height: 200px;'>", "\\( 552 : 4 = 276 : 2 = 138 \\)", "\\( \\frac{552}{4} = \\frac{500}{4}+\\frac{50}{4}+\\frac{2}{4}=\\frac{400}{4}+\\frac{120}{4}+\\frac{32}{4}=100+30+8 = 138 \\)"], answer: 3 },
        // --- Exploration 4 (Soal 36-40) ---
        { level: "Exploration 4", text: "Anne sedang mencari jumlah dari \\(\\frac{1}{2}\\) dan \\(\\frac{1}{3}\\). Langkah pertama yang ia lakukan adalah menyamakan penyebut menjadi 6.<br><br>Pilih alasan yang <strong>TIDAK TEPAT</strong> mengapa Anne melakukan hal tersebut.", options: ["Penjumlahan dan pengurangan pecahan hanya bisa dikerjakan ketika ukuran potongannya (satuannya) sama.", "Sama seperti 1 kodi dan 1 lusin tidak bisa langsung dijumlahkan, 1 perdua dan 1 pertiga juga tidak bisa langsung dijumlahkan.", "Cara terbaik untuk menyamakan penyebut adalah dengan selalu mengkalikan penyebut-penyebutnya (\\(2 \\times 3\\)).", "Anne memilih bilangan 6 karena 6 adalah Kelipatan Persekutuan Terkecil (KPK) dari 2 dan 3.", "Menggunakan KPK bertujuan untuk mendapatkan pecahan yang paling sederhana saat menjumlahkan."], answer: 2 },
        { level: "Exploration 4", text: "Perhatikan gambar pecahan campuran di bawah ini.<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_lixadg_3523.png' class='q-img'><br>Pilih bentuk penulisan bilangan yang <strong>TIDAK SESUAI</strong> dengan gambar di atas.", options: ["\\( 2,33... \\)", "\\( 2\\frac{1}{3} \\)", "\\( \\frac{7}{3} \\)", "7 pertiga", "\\( 2,33 \\)"], answer: 4 },
        { level: "Exploration 4", text: "Juno sedang mengukur massa sebungkus jeruk dengan neraca. Neraca seimbang ketika Juno menempatkan:<br><ul><li>2 bandul 1 kg</li><li>1 bandul 500 g</li><li>3 bandul 100 g</li></ul><br>Ada 8 jeruk dalam bungkusan tersebut. Jika massa jeruk dianggap sama, berapa <strong>massa 1 jeruk</strong> dalam satuan kilogram (dibulatkan ke persepuluhan terdekat)?", options: ["0,3 kg", "0,35 kg", "0,4 kg", "2,8 kg", "3,5 kg"], answer: 2 },
        { level: "Exploration 4", text: "Manakah di antara pilihan berikut yang menunjukkan gambar <strong>segitiga tumpul sembarang</strong>?", options: ["<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_mhigra_6610.png' class='opt-img'>", "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_ha1iuv_9917.png' class='opt-img'>", "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_iuijrs_8047.png' class='opt-img'>", "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_onhdj1_7390.png' class='opt-img'>", "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_vm49m2_9766.png' class='opt-img'>"], answer: 2 },
        { level: "Exploration 4", text: "Perhatikan grafik suhu rata-rata harian Kota Zula di bawah ini.<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_a91pqd_2599.png' class='q-img'><br><strong>Kenaikan suhu terbesar</strong> terjadi dari tanggal ...", options: ["21 ke 22 Maret", "22 ke 23 Maret", "23 ke 24 Maret", "24 ke 25 Maret", "25 ke 26 Maret"], answer: 4 },
        // --- Mastery 1 (Soal 41-45) ---
        { level: "Mastery 1", text: "Hitunglah hasil dari operasi bilangan berikut:<br>\\[ 88 \\times 125 - 18 \\times 50 - 24 \\times 25 - 2 \\times 100 = \\dots \\]", options: ["9.200", "9.300", "9.400", "10.300", "11.000"], answer: 1 },
        { level: "Mastery 1", text: "Lina mempunyai \\(3\\frac{1}{4}\\) meter pita merah. Dia membeli lagi \\(2\\frac{2}{3}\\) meter untuk mendekorasi kelasnya. Jika pita yang terpakai adalah \\(4\\frac{5}{6}\\) meter, berapa meter <strong>sisa pita</strong> yang dimiliki Lina?", options: ["\\( 1\\frac{1}{12} \\) meter", "\\( 1\\frac{1}{6} \\) meter", "\\( 1\\frac{1}{4} \\) meter", "\\( \\frac{11}{12} \\) meter", "\\( 2\\frac{1}{12} \\) meter"], answer: 0 },
        { level: "Mastery 1", text: "Diketahui dua buah kubus, Kubus A dan Kubus B. Panjang sisi Kubus B adalah <strong>3 kali panjang sisi</strong> Kubus A. Jika volume Kubus A adalah \\( 5~cm^3 \\), berapakah <strong>volume Kubus B</strong>?<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_hyriw4_786.png' class='q-img'>", options: ["\\( 15~cm^3 \\)", "\\( 27~cm^3 \\)", "\\( 45~cm^3 \\)", "\\( 125~cm^3 \\)", "\\( 135~cm^3 \\)"], answer: 4 },
        { level: "Mastery 1", text: "Ibu membuat sejumlah kue. \\(\\frac{1}{2}\\) dari seluruh kue diberikan kepada nenek. \\(\\frac{2}{3}\\) dari <strong><em>sisanya</em></strong> diberikan kepada bibi. Jika jumlah kue yang tersisa sekarang adalah 5 buah, berapakah jumlah kue yang ibu buat <strong>mula-mula</strong>?", options: ["15 kue", "20 kue", "25 kue", "30 kue", "45 kue"], answer: 3 },
        { level: "Mastery 1", text: "Di antara pilihan kecepatan berikut, manakah yang nilainya <strong>berbeda</strong> dari yang lain?", options: ["60 km/jam", "1 km/menit", "\\( 16\\frac{2}{3} \\) m/detik", "1.000 km/menit", "1.000 m/menit"], answer: 3 },
        // --- Mastery 2 (Soal 46-50) ---
        { level: "Mastery 2", text: "Hitunglah hasil dari: \\[ 20 - 12 : 4 + 3 \\times 2 = \\dots \\]", options: ["8", "10", "14", "23", "26"], answer: 3 },
        { level: "Mastery 2", text: "Ali membelanjakan uangnya <strong>5 kali lebih banyak</strong> daripada Baba di sebuah toko. Ali membayar dengan selembar uang Rp20.000 dan menerima kembalian Rp2.000. Berapa banyak <strong>uang yang dibelanjakan Baba</strong>?", options: ["Rp3.000", "Rp3.500", "Rp3.600", "Rp4.000", "Rp4.500"], answer: 2 },
        { level: "Mastery 2", text: "Perhatikan gambar bangun datar dengan dimensi berikut. Manakah di antara bangun berikut yang memiliki <strong>luas yang berbeda</strong> dari yang lain?", options: ["<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_ccaldw_5137.png' class='opt-img'>", "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_5kmrmc_4024.png' class='opt-img'>", "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_yqgteq_2623.png' class='opt-img'>", "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_ew6pym_1651.png' class='opt-img'>", "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_6jlqrw_5151.png' class='opt-img'>"], answer: 2 },
        { level: "Mastery 2", text: "Sebuah bak mandi berbentuk balok akan terisi penuh dengan 450 liter air. Jika panjang bak mandi adalah 1 meter dan lebarnya 60 cm, berapakah <strong>tinggi bak mandi</strong> tersebut?", options: ["7,5 cm", "75 cm", "80 cm", "0,75 cm", "7,5 meter"], answer: 1 },
        { level: "Mastery 2", text: "Tabel di bawah ini menunjukkan nilai ujian akhir matematika dari 5 orang siswa.<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_bdwoas_1258.png' class='q-img'><br>Ada berapa anak yang nilainya <strong>di atas rata-rata</strong> dari kelima siswa tersebut?", options: ["1 anak", "2 anak", "3 anak", "4 anak", "5 anak"], answer: 2 },
        // --- Mastery 3 (Soal 51-55) ---
        { level: "Mastery 3", text: "Diketahui:<br>\\[ A : B = 5 : 6 \\]<br>\\[ B : C = 3 : 8 \\]<br>\\[ C - A = 3 \\]<br>Cari nilai \\( B + C \\)", options: ["6", "12", "18", "22", "24"], answer: 0 },
        { level: "Mastery 3", text: "\\(\\frac{1}{3}\\) uang Andi sama dengan \\(\\frac{2}{5}\\) uang Budi. Jika <strong>selisih uang</strong> mereka Rp5.000, berapa <strong>total uang</strong> keduanya?", options: ["Rp45.000,00", "Rp50.000,00", "Rp55.000,00", "Rp60.000,00", "Rp65.000,00"], answer: 2 },
        { level: "Mastery 3", text: "Sebuah segitiga sama kaki memiliki dua sudut yang sama besar dan satu sudut lain yang berbeda. Sudut yang berbeda itu merupakan <strong>sudut terbesar</strong> segitiga dan besarnya \\(70^{\\circ}\\). Berapakah hasil <strong>penjumlahan kedua sudut yang lain</strong>?", options: ["\\(70^\\circ\\)", "\\(100^\\circ\\)", "\\(110^\\circ\\)", "\\(140^\\circ\\)", "\\(180^\\circ\\)"], answer: 2 },
        { level: "Mastery 3", text: "Harga mainan kesukaan kakak <strong>naik 20%</strong> dibandingkan dengan harga sebelumnya. Jika harga sekarang adalah Rp72.000, berapa harga mainan tersebut <strong>sebelum mengalami kenaikan</strong>?", options: ["Rp57.600,00", "Rp60.000,00", "Rp62.000,00", "Rp64.000,00", "Rp68.000,00"], answer: 1 },
        { level: "Mastery 3", text: "Rata-rata dari 4 bilangan adalah 9. Jika salah satu bilangan dibuang, rata-ratanya menjadi 8. Berapakah <strong>bilangan yang dibuang</strong> tersebut?", options: ["9", "10", "11", "12", "13"], answer: 3 },
        // --- Mastery 4 (Soal 56-60) ---
        { level: "Mastery 4", text: "Perhatikan gambar di bawah ini.<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_a5fnos_7001.png' class='q-img'><br>Tentukan operasi pecahan yang sedang diilustrasikan oleh gambar di atas.", options: ["\\(\\frac{2}{3}+\\frac{1}{3}=1\\)", "\\(\\frac{8}{15}+\\frac{7}{15}=1\\)", "\\(\\frac{4}{5}\\times\\frac{2}{3}=\\frac{8}{15}\\)", "\\(2\\times\\frac{4}{15}=\\frac{8}{15}\\)", "\\(\\frac{4}{5}+\\frac{2}{3}=\\frac{22}{15}\\)"], answer: 2 },
        { level: "Mastery 4", text: "Merisa menggunakan \\(\\frac{3}{4}\\) uangnya untuk membeli sebuah buku. Kemudian, ia menggunakan \\(\\frac{1}{2}\\) <strong>dari sisanya</strong> untuk membeli sebuah kalkulator. Jika <strong>harga buku</strong> Rp30.000 lebih mahal dari harga kalkulator, berapakah harga buku tersebut?", options: ["Rp30.000,00", "Rp36.000,00", "Rp42.000,00", "Rp48.000,00", "Rp54.000,00"], answer: 1 },
        { level: "Mastery 4", text: "Perhatikan gambar di bawah ini.<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_lwxdzu_2359.png' class='q-img'><br>Gambar di atas terbentuk dari sebuah persegi dengan panjang sisi 10 cm dan seperempat lingkaran. Berapakah <strong>luas daerah yang diarsir</strong>? Gunakan pendekatan \\(\\Pi\\approx3,14\\).", options: ["21,5 cm¬≤", "31,4 cm¬≤", "50 cm¬≤", "78,5 cm¬≤", "100 cm¬≤"], answer: 0 },
        { level: "Mastery 4", text: "Pada pk. 07.00, seorang anak bersepeda dari rumah ke perpustakaan dengan kecepatan \\(18~km/jam.\\) Setelah 20 menit berselang, ibunya menyusul dengan sepeda listrik dengan kecepatan \\(24~km/jam.\\) Jika jalan dari rumah ke perpustakaan lurus dan kecepatan mereka konstan, pada <strong>pukul berapa</strong> ibu tersebut akan <strong>menyusul</strong> anaknya?", options: ["08.00", "08.10", "08.20", "08.30", "08.40"], answer: 2 },
        { level: "Mastery 4", text: "Pada suatu kelas olahraga, diketahui 24% peserta mengikuti permainan voli. Sudut pembentuk juring bertuliskan SEPAKBOLA pada diagram lingkaran adalah 144¬∞. Jika jumlah seluruh peserta kelas olahraga adalah 50 orang, berapa <strong>peserta yang mengikuti permainan basket</strong>?<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_tc8mcb_2669.png' class='q-img'>", options: ["12 Siswa", "15 Siswa", "18 Siswa", "20 Siswa", "24 Siswa"], answer: 2 }
    ];

    // 2. STATE & CONFIG
    // Urutan Level dari termudah ke tersulit
    const LEVEL_ORDER = [
        "Discovery 1", "Discovery 2", "Discovery 3", "Discovery 4",
        "Exploration 1", "Exploration 2", "Exploration 3", "Exploration 4",
        "Mastery 1", "Mastery 2", "Mastery 3", "Mastery 4"
    ];

    let studentName = "";
    let studentClass = "";  // Tambahan state untuk menyimpan kelas
    let minIndex = 0;               
    let maxIndex = LEVEL_ORDER.length - 1; 
    let currentLevelIndex = 0;      
    
    let questionsInCurrentLevel = []; 
    let currentQuestionPointer = 0;   
    let currentLevelScore = 0;      
    let currentLevelWrong = 0; // NEW: Track consecutive wrongs in a level
    
    let totalCorrectAnswers = 0;    
    let timeRemaining = 3600;       
    let timerInterval;
    let isAnswering = true;
    let wrongAnswers = [];          
    let bestLevelReached = "Foundation"; 

    // --- MAIN FUNCTIONS ---

    window.onload = function() {
        // Reset state on load
        minIndex = 0;
        maxIndex = LEVEL_ORDER.length - 1;
    };

    window.saveNameAndContinue = function() {
        const name = document.getElementById('studentNameInput').value.trim();
        const cls = document.getElementById('studentClassInput').value; // Ambil nilai kelas
        
        if (name) {
            studentName = name;
            studentClass = cls; // Simpan kelas
            inputNameScreen.classList.remove('active');
            startScreen.classList.add('active');
        } else {
            alert("Silakan masukkan nama kamu.");
        }
    };

    window.startGame = function() {
        startScreen.classList.remove('active');
        gameScreen.classList.add('active');
        statusBar.style.visibility = 'visible';

        // RESET VARS
        minIndex = 0;
        maxIndex = LEVEL_ORDER.length - 1;
        totalCorrectAnswers = 0;
        wrongAnswers = [];
        bestLevelReached = "Placement Start";

        // TIMER (Hidden UI)
        if (timerInterval) clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            timeRemaining--;
            if(timeRemaining >= 0) {
                let m = Math.floor(timeRemaining / 60);
                let s = timeRemaining % 60;
                document.getElementById('timerDisplay').innerText = `${m < 10 ? '0'+m : m}:${s < 10 ? '0'+s : s}`;
            }
            if (timeRemaining <= 0) finishGame();
        }, 1000);

        // MULAI BLOCK PERTAMA (Langsung Binary Search Standard dari Tengah)
        startNextLevelBlock();
    };

    function startNextLevelBlock() {
        // LOGIKA UTAMA BINARY SEARCH
        
        if (minIndex > maxIndex) {
            finishGame();
            return;
        }
        
        // Ambil titik tengah dari range tersisa
        currentLevelIndex = Math.floor((minIndex + maxIndex) / 2);

        const levelName = LEVEL_ORDER[currentLevelIndex];

        // Ambil 5 soal untuk level ini
        questionsInCurrentLevel = questions.filter(q => q.level === levelName);
        
        // Reset pointer & score level ini
        currentQuestionPointer = 0;
        currentLevelScore = 0;
        currentLevelWrong = 0; // Reset kesalahan
        
        loadQuestion();
    }

    function loadQuestion() {
        feedbackArea.style.display = 'none';
        isAnswering = true;

        // Visual Progress Bar (0% - 100% dalam konteks 5 soal per level)
        const progress = (currentQuestionPointer / questionsInCurrentLevel.length) * 100;
        progressBar.style.width = `${progress}%`;

        const q = questionsInCurrentLevel[currentQuestionPointer];
        
        // Tampilkan Level label kecil di atas soal
        questionText.innerHTML = `<div style="font-size:0.8em; color:#e67e22; margin-bottom:10px; text-transform:uppercase;">${q.level} - Soal ${currentQuestionPointer + 1}/5</div>` + q.text;
        
        optionsContainer.innerHTML = '';
        optionsContainer.style.gridTemplateColumns = (window.innerWidth > 600 && q.options.length !== 5) ? "repeat(2, 1fr)" : "1fr";

        q.options.forEach((opt, index) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerHTML = opt;
            btn.onclick = () => checkAnswer(index, btn);
            optionsContainer.appendChild(btn);
        });

        // Render MathJax
        if(window.renderMathInElement) {
             renderMathInElement(gameScreen, { delimiters: [
                 {left: '$$', right: '$$', display: true}, 
                 {left: '$', right: '$', display: false},
                 {left: '\\(', right: '\\)', display: false},
                 {left: '\\[', right: '\\]', display: true}
             ]});
        }
        
        // Scroll top
        if(window.innerWidth < 768) window.scrollTo({top:0, behavior:'smooth'});
        else document.querySelector('.game-stage').scrollTo({top:0, behavior:'smooth'});
    }

    function checkAnswer(selectedIndex, btnElement) {
        if (!isAnswering) return; 
        isAnswering = false;
        
        const q = questionsInCurrentLevel[currentQuestionPointer];
        document.querySelectorAll('.option-btn').forEach(b => b.disabled = true);

        if (selectedIndex === q.answer) {
            btnElement.classList.add('correct');
            feedbackMessage.innerText = "Benar! üéâ";
            feedbackMessage.style.color = "#27ae60";
            currentLevelScore++;
            totalCorrectAnswers++;
        } else {
            btnElement.classList.add('wrong');
            feedbackMessage.innerText = "Kurang Tepat üòî";
            feedbackMessage.style.color = "#c0392b";
            
            currentLevelWrong++; // Catat kesalahan di level ini

            // Catat salah untuk report
            wrongAnswers.push({
                level: q.level,
                text: q.text,
                options: q.options,
                userIndex: selectedIndex,
                correctIndex: q.answer
            });
        }

        feedbackArea.style.display = 'flex';
        
        // Update fungsi tombol lanjut
        nextBtn.onclick = nextQuestionLogic;
    }

    function nextQuestionLogic() {
        currentQuestionPointer++;

        // Modified Logic: Cek apakah 5 soal habis ATAU sudah salah >= 2 kali (Early Exit)
        if (currentQuestionPointer >= questionsInCurrentLevel.length || currentLevelWrong >= 2) {
            evaluateLevelBlock();
        } else {
            loadQuestion();
        }
    }

    function evaluateLevelBlock() {
        // Logika Penentuan Nasib:
        // Lulus jika Benar >= 4 dari 5 soal
        const isPassed = currentLevelScore >= 4;
        const currentLevelName = LEVEL_ORDER[currentLevelIndex];

        let titleMsg = "";
        let bodyMsg = "";

        if (isPassed) {
            // LULUS -> Simpan level ini sebagai kandidat terbaik sementara
            bestLevelReached = currentLevelName;
            
            // Geser pencarian ke kanan (Level lebih tinggi)
            minIndex = currentLevelIndex + 1;
            
            titleMsg = "Luar Biasa! üåü";
            bodyMsg = `Kamu menguasai ${currentLevelName}. Mari kita coba level yang lebih tinggi!`;
        } else {
            // GAGAL -> Range level terlalu tinggi
            // Geser pencarian ke kiri (Level lebih rendah)
            maxIndex = currentLevelIndex - 1;

            titleMsg = "Analisis Selesai üìâ";
            if (currentLevelWrong >= 2) {
                bodyMsg = `Level ${currentLevelName} tampaknya terlalu menantang. Kami akan menyesuaikan soal untukmu.`;
            } else {
                bodyMsg = `Level ${currentLevelName} terlalu menantang. Kami akan menyesuaikan soal untukmu.`;
            }
        }

        // Jika algoritma akan berhenti (karena min > max), ubah pesan
        if (minIndex > maxIndex) {
            bodyMsg = "Tes selesai. Menghitung hasil akhir...";
        }

        // Tampilkan Modal Checkpoint
        checkpointMsg.innerText = isPassed ? "LEVEL UP" : "ADJUSTING...";
        checkpointMsg.style.color = isPassed ? "#27ae60" : "#f39c12";
        document.querySelector('.checkpoint-content h2').innerText = titleMsg;
        document.querySelector('.checkpoint-content p:nth-of-type(2)').innerText = bodyMsg;
        
        document.getElementById('checkpointModal').style.display = 'flex';
    }

    window.closeCheckpoint = function() {
        document.getElementById('checkpointModal').style.display = 'none';
        startNextLevelBlock(); // Lanjut ke blok berikutnya (atau finish)
    };

    function finishGame() {
        clearInterval(timerInterval);
        gameScreen.classList.remove('active');
        resultScreen.classList.add('active');
        statusBar.style.visibility = 'hidden';

        // Hitung Waktu
        let timeUsed = 3600 - timeRemaining;
        let m = Math.floor(timeUsed / 60);
        let s = timeUsed % 60;
        let timeString = `${m < 10 ? '0'+m : m}:${s < 10 ? '0'+s : s}`;

        // Fallback jika gagal di level paling awal
        if (bestLevelReached === "Placement Start" && maxIndex < 0) {
            bestLevelReached = "Foundation (Pre-Discovery)";
        }

        document.getElementById('finalPlacement').innerText = bestLevelReached.toUpperCase();
        document.getElementById('finalScore').innerText = totalCorrectAnswers; 
        document.getElementById('timeUsed').innerText = timeString;

        generateReportCard();
    }

    function generateReportCard() {
        const list = document.getElementById('reportList');
        list.innerHTML = '';
        
        if (wrongAnswers.length === 0) {
            list.innerHTML = '<li class="report-item" style="text-align:center; color:#27ae60;">Sempurna! Tidak ada kesalahan pada soal yang dikerjakan.</li>';
            return;
        }

        wrongAnswers.forEach((item, idx) => {
            const li = document.createElement('li');
            li.className = 'report-item';
            
            let gridHtml = `<div class="report-grid">`;
            item.options.forEach((opt, optIdx) => {
                let statusClass = '';
                if (optIdx === item.correctIndex) statusClass = 'correct';
                else if (optIdx === item.userIndex) statusClass = 'wrong';
                
                gridHtml += `<div class="option-btn report-variant ${statusClass}">${opt}</div>`;
            });
            gridHtml += `</div>`;

            li.innerHTML = `
                <div class="report-meta">${item.level}</div>
                <div class="report-q-text">${item.text}</div>
                ${gridHtml}
            `;
            list.appendChild(li);
        });
        
        if(window.renderMathInElement) {
             renderMathInElement(list);
        }
    }

    window.toggleReport = function() {
        const rc = document.getElementById('reportCard');
        const btn = document.getElementById('btnReportToggle');
        
        if (rc.style.display === 'block') {
            rc.style.display = 'none';
            btn.innerText = 'üìã Lihat Detail Jawaban Salah';
        } else {
            rc.style.display = 'block';
            btn.innerText = 'üîº Tutup Detail';
            setTimeout(() => rc.scrollIntoView({ behavior: 'smooth' }), 100);
        }
    };
    
    window.clearAndReload = function() {
        location.reload();
    }
</script>
</body>
</html>
