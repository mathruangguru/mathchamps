<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Math Champs Placement Test</title>
    
    <!-- Font 'Nunito' & 'Noto Sans' -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Noto+Sans:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- KaTeX untuk Rumus Matematika Cantik -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <style>
        :root {
            --primary: #FF9F1C; 
            --primary-dark: #e08b15;
            --secondary: #2EC4B6;
            --secondary-dark: #259f93;
            --accent: #E71D36;
            --dark: #011627;
            --light: #FDFFFC;
            --bg-gradient: linear-gradient(135deg, #E0F7FA 0%, #80DEEA 100%);
            --header-bg: #011627;
            --text-main: #2c3e50;
            
            /* Singapore Math Palette */
            --mainblue: #006EBE;
            --softblue: #EBF5FF;
            --maingreen: #28B464;
            --softgreen: #EBFAF0;
            --mainred: #DC3C32;
            --softred: #FFF0F0;
            --honeyyellow: #FFC832;
            --honeysoft: #FFF5D2;
            
            /* Chart Colors */
            --barblue: #5B9BD5;
            --bargreen: #70AD47;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- GLOBAL LAYOUT --- */
        html {
            height: 100%;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: var(--bg-gradient);
            margin: 0;
            padding: 0;
            color: var(--text-main);
            height: 100%;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            width: 100vw;
            background-image: 
                radial-gradient(#2EC4B6 1px, transparent 1px), 
                radial-gradient(#2EC4B6 1px, transparent 1px);
            background-position: 0 0, 25px 25px;
            background-size: 50px 50px;
            background-color: #f0f8ff;
        }

        /* --- HEADER --- */
        header {
            background: var(--header-bg);
            padding: 15px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            z-index: 50;
            position: relative;
            flex-shrink: 0; 
            height: 80px;
        }

        .logo {
            height: 40px;
            object-fit: contain;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
            display: block; 
        }

        .status-bar {
            display: flex;
            gap: 15px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.15);
            padding: 10px 20px; 
            border-radius: 50px;
            font-weight: 800;
            color: white;
            font-size: 1.2rem; 
            border: 2px solid rgba(255,255,255,0.2);
            transition: transform 0.2s, background 0.2s;
        }
        
        .status-item span:first-child {
            font-size: 1.4rem;
        }
        
        .status-item.pulse-green {
            animation: pulseGreen 1s ease;
            background: rgba(46, 204, 113, 0.4);
        }

        @keyframes pulseGreen {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* --- DESKTOP LAYOUT (IMMERSIVE) --- */
        @media (min-width: 769px) {
            body {
                overflow: hidden; 
            }
            .app-container {
                height: 100vh;
            }
            .game-stage {
                flex: 1;
                overflow-y: auto; 
                padding: 20px;
                display: flex;
                justify-content: center;
                scrollbar-width: thin;
                scrollbar-color: #ccc transparent;
            }
            .content-card {
                margin: auto 0;
                max-width: 900px;
                background: rgba(255, 255, 255, 0.95);
                border-radius: 24px;
                padding: 40px;
                box-shadow: 0 10px 40px rgba(1, 22, 39, 0.1);
                animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                width: 100%;
            }
            .feedback-container {
                margin-top: 30px;
                position: static;
                display: none; 
                flex-direction: column;
                align-items: center;
                animation: popIn 0.3s ease;
            }
        }

        /* --- MOBILE LAYOUT (SCROLL FIX) --- */
        @media (max-width: 768px) {
            body {
                overflow-y: auto; 
                height: auto;
            }
            html {
                height: auto;
            }
            .app-container {
                height: auto;
                min-height: 100vh;
                background-size: 20px 20px;
            }
            header {
                position: sticky;
                top: 0;
                padding: 12px 20px;
                justify-content: space-between; 
            }
            .game-stage {
                display: block;
                height: auto;
                padding: 0;
                overflow: visible; 
            }
            .content-card {
                background: white;
                max-width: none;
                border-radius: 0;
                box-shadow: none;
                margin: 0;
                min-height: calc(100vh - 80px); 
                padding: 25px 20px 150px 20px; 
            }
            
            h1 { font-size: 1.6rem !important; }
            .question-box { font-size: 1.1rem !important; }
            
            .feedback-container {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: white;
                padding: 20px;
                box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
                animation: slideUp 0.3s ease;
                border-top: 1px solid #eee;
                display: none; 
                flex-direction: column;
                align-items: center;
                z-index: 100;
            }
        }

        /* --- ANIMATIONS & COMMON --- */
        @keyframes popIn {
            from { opacity: 0; transform: scale(0.95) translateY(20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        h1 {
            color: var(--primary);
            font-weight: 900;
            font-size: 2.2rem;
            margin: 0 0 10px 0;
            text-transform: uppercase;
            letter-spacing: -0.5px;
        }

        h2 {
            color: #7f8c8d;
            font-weight: 600;
            margin: 0;
        }

        /* INPUT FIELD STYLES */
        .input-group {
            margin-bottom: 25px;
            text-align: left;
            width: 100%;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .input-label {
            display: block;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--dark);
            font-size: 1.1rem;
        }
        
        .name-input {
            width: 100%;
            padding: 15px 20px;
            font-size: 1.2rem;
            border: 2px solid #e0e6ed;
            border-radius: 15px;
            font-family: 'Nunito', sans-serif;
            outline: none;
            transition: border-color 0.2s;
        }
        
        .name-input:focus {
            border-color: var(--primary);
        }

        .progress-container {
            background: #eef2f5;
            height: 14px;
            border-radius: 50px;
            margin: 0 0 30px; 
            overflow: hidden;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), #ffcb05);
            width: 0%;
            border-radius: 50px;
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background-image: linear-gradient(
                45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent
            );
            background-size: 20px 20px;
            animation: moveStripes 1s linear infinite;
        }

        @keyframes moveStripes {
            0% { background-position: 0 0; }
            100% { background-position: 20px 20px; }
        }

        .question-box {
            font-size: 1.35rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .q-img {
            max-width: 100%;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin: 20px 0;
            border: 4px solid #fff;
        }
        
        /* --- PIKTOGRAF / TABLE STYLES --- */
        .piktograf-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px auto;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border-radius: 8px;
            overflow: hidden;
            font-size: 0.95rem;
            max-width: 500px;
        }
        
        .piktograf-table th {
            background: #f1f5f9;
            color: #334155;
            font-weight: 800;
            padding: 12px 15px;
            text-align: left;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .piktograf-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #f1f5f9;
            vertical-align: middle;
        }
        
        .piktograf-table tr:last-child td {
            border-bottom: none;
        }
        
        .star-icon {
            width: 24px;
            height: 24px;
            fill: #FFD700;
            stroke: #F39C12;
            stroke-width: 1.5;
            vertical-align: middle;
            margin-right: 2px;
            filter: drop-shadow(0 1px 1px rgba(0,0,0,0.1));
        }
        
        /* --- CUSTOM VISUAL STYLES FOR NEW QUESTIONS (11-30) --- */
        .math-visual {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .math-visual svg {
            width: 100%;
            height: auto;
            max-width: 100%;
        }
        
        /* Blank Space for Fill in the Blanks */
        .blank-space {
            display: inline-block;
            width: 50px;
            border-bottom: 2px solid #333;
            text-align: center;
        }
        
        /* Dienes Block Styles */
        .dienes-hundred { fill: var(--softblue); stroke: var(--mainblue); stroke-width: 1px; }
        .dienes-ten { fill: var(--softgreen); stroke: var(--maingreen); stroke-width: 1px; }
        .dienes-one { fill: var(--softred); stroke: var(--mainred); stroke-width: 1px; }
        
        /* Honeycomb Styles */
        .hex { 
            fill: #FFF8DC; 
            stroke: #CD853F; 
            stroke-width: 3px; 
            stroke-linejoin: round; 
        }
        .hex-text { 
            font-weight: 700; 
            font-size: 18px; 
            fill: black; 
            dominant-baseline: middle; 
            text-anchor: middle; 
            font-family: 'Noto Sans', sans-serif; 
        }

        /* GRID DI REPORT CARD */
        .report-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            width: 100%;
        }
        
        /* Mobile Report Grid: 1 Column */
        @media(max-width: 600px) {
            .report-grid { grid-template-columns: 1fr !important; }
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        @media (max-width: 600px) {
            .options-grid { grid-template-columns: 1fr; }
        }

        .option-btn {
            background: white;
            border: 2px solid #e0e6ed;
            border-bottom: 6px solid #e0e6ed;
            padding: 20px;
            border-radius: 20px;
            font-size: 1.1rem;
            color: var(--text-main);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.15s ease;
            position: relative;
            font-family: 'Nunito', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .option-btn:hover:not(:disabled) {
            border-color: var(--secondary);
            border-bottom-color: var(--secondary-dark);
            background: #f0fffd;
            transform: translateY(-2px);
        }

        .option-btn:active:not(:disabled) {
            transform: translateY(4px);
            border-bottom-width: 2px;
            margin-top: 4px;
        }

        .option-btn:disabled {
            opacity: 0.8;
            cursor: default;
        }

        .option-btn.correct {
            background: #d1f7c4;
            border-color: #2ecc71;
            border-bottom-color: #27ae60;
            color: #27ae60;
        }

        .option-btn.wrong {
            background: #fadbd8;
            border-color: #e74c3c;
            border-bottom-color: #c0392b;
            color: #c0392b;
        }
        
        /* Small variant for report card buttons */
        .option-btn.report-variant {
            padding: 15px;
            font-size: 1rem;
            min-height: auto;
            border-bottom-width: 3px;
            cursor: default;
            pointer-events: none; /* Make unclickable */
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            border-bottom: 5px solid var(--primary-dark);
            padding: 18px 40px;
            font-size: 1.2rem;
            border-radius: 50px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.1s;
            font-family: 'Nunito', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: inline-block;
            margin-top: 20px;
            width: 100%;
        }

        .btn:active {
            transform: translateY(3px);
            border-bottom-width: 2px;
            margin-top: 23px;
        }

        .btn-next {
            background: var(--secondary);
            border-bottom: 5px solid var(--secondary-dark);
        }
        
        .btn-report {
            background: white;
            color: var(--dark);
            border: 2px solid #ddd;
            border-bottom: 5px solid #ccc;
            margin-top: 15px;
        }
        
        .btn-report:active {
            border-bottom-width: 2px;
            margin-top: 18px;
        }
        
        .btn-csv {
            background: #27ae60;
            border-bottom: 5px solid #219150;
            margin-top: 15px;
        }
        
        .btn-dashboard {
            background: #34495e;
            border-bottom: 5px solid #2c3e50;
            font-size: 0.9rem;
            margin-top: 10px;
            width: auto;
            padding: 10px 20px;
        }

        .feedback-msg {
            font-size: 1.4rem;
            font-weight: 800;
            margin-bottom: 15px;
        }
        
        .life-bonus-notif {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            font-size: 1.5rem;
            font-weight: bold;
            z-index: 200;
            pointer-events: none;
            animation: floatUpFade 2s forwards;
            display: none;
            text-align: center;
        }
        
        @keyframes floatUpFade {
            0% { opacity: 0; transform: translate(-50%, -40%); }
            20% { opacity: 1; transform: translate(-50%, -50%); }
            80% { opacity: 1; transform: translate(-50%, -60%); }
            100% { opacity: 0; transform: translate(-50%, -70%); }
        }

        /* Checkpoint Overlay */
        .checkpoint-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(1, 22, 39, 0.9);
            z-index: 200;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            animation: fadeIn 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .checkpoint-content {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            animation: zoomIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        .checkpoint-content::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 10px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        @keyframes zoomIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* REPORT CARD STYLES */
        .report-card {
            display: none; /* Hidden by default */
            margin-top: 30px;
            text-align: left;
            background: #fff;
            border-radius: 15px;
            border: 2px solid #eee;
            overflow: hidden;
            animation: slideUp 0.3s ease;
        }
        
        .report-header {
            background: var(--dark);
            color: white;
            padding: 15px 20px;
            font-weight: 800;
            font-size: 1.1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .report-list {
            padding: 0;
            margin: 0;
            list-style: none;
            max-height: 500px; /* Taller to accommodate visual answers */
            overflow-y: auto;
        }
        
        .report-item {
            padding: 25px 20px;
            border-bottom: 4px solid #f0f4f8;
            font-size: 0.95rem;
        }
        
        .report-item:last-child {
            border-bottom: none;
        }
        
        .report-meta {
            display: inline-block;
            background: #e3f2fd;
            color: #1565c0;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 800;
            margin-bottom: 15px;
            text-transform: uppercase;
        }
        
        .report-q-text {
            margin-bottom: 20px;
            font-weight: 700;
            color: var(--dark);
            font-size: 1.1rem;
        }
        
        .report-q-text img {
            max-width: 100%;
            height: auto;
            max-height: 200px; 
            display: block;
            margin: 10px 0;
            border-radius: 8px;
            border: 1px solid #eee;
        }

        .screen { display: none; width: 100%; }
        .screen.active { display: block; }

        .result-level {
            /* FIX FONT SIZE CLIPPING ON MOBILE with clamp */
            font-size: clamp(2rem, 8vw, 3.5rem); 
            font-weight: 900;
            color: white;
            text-shadow: 2px 2px 0 rgba(0,0,0,0.1);
            word-wrap: break-word;
            line-height: 1.1;
        }
        
        .result-card-inner {
            background: linear-gradient(135deg, #FF9F1C, #FF5E00);
            padding: 40px;
            border-radius: 30px;
            color: white;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
            box-shadow: 0 15px 30px rgba(255, 159, 28, 0.4);
        }

        .result-card-inner::before {
            content: 'üèÜ';
            position: absolute;
            font-size: 10rem;
            opacity: 0.1;
            right: -20px;
            bottom: -20px;
            transform: rotate(-15deg);
        }

        .opt-img { max-height: 80px; object-fit: contain; pointer-events: none; }
        
        /* HIDE REQUESTED ELEMENTS */
        .game-info-header {
            display: none !important;
        }
        
        /* DASHBOARD TABLES (HIDDEN AS UNUSED) */
        .dashboard-table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .dashboard-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            font-size: 0.9rem;
        }
        
        .dashboard-table th {
            background: var(--dark);
            color: white;
            padding: 15px;
            text-align: left;
        }
        
        .dashboard-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            color: #333;
        }
        
        .dashboard-table tr:hover {
            background: #f8f9fa;
        }
    </style>
</head>
<body>

<div class="app-container">
    <!-- HEADER -->
    <header>
        <!-- Logo Displayed -->
        <img src="https://imgix3.ruangguru.com/assets/miscellaneous/png_aaojxe_9962.png" alt="Math Champs" class="logo">
        
        <div class="status-bar" id="statusBar" style="visibility: hidden;">
            <div class="status-item" id="lifeContainer">
                <span>‚ù§Ô∏è</span> <span id="livesDisplay">3</span>
            </div>
            <!-- Timer hidden visually but logic remains -->
            <div class="status-item" style="display: none;">
                <span>‚è±Ô∏è</span> <span id="timerDisplay">60:00</span>
            </div>
        </div>
    </header>

    <!-- MAIN GAME STAGE -->
    <div class="game-stage">
        <div class="content-card" style="position: relative;">
            
            <!-- SCREEN 0: INPUT NAME -->
            <div id="inputNameScreen" class="screen active" style="text-align: center;">
                <div style="font-size: 4rem; margin-bottom: 10px;">üëã</div>
                <h1>Halo, Champion!</h1>
                <h2 style="margin-bottom: 40px;">Siapa nama kamu?</h2>

                <div class="input-group">
                    <label class="input-label">Nama Lengkap</label>
                    <input type="text" id="studentNameInput" class="name-input" placeholder="Tulis namamu di sini..." autocomplete="off">
                </div>

                <button class="btn" onclick="saveNameAndContinue()">Lanjut</button>
            </div>

            <!-- SCREEN 1: START -->
            <div id="startScreen" class="screen" style="text-align: center;">
                <div style="font-size: 4rem; margin-bottom: 10px;">üî•</div>
                <h1>Siapkan Mentalmu!</h1>
                <h2 style="margin-bottom: 30px;">Waktu terus berjalan. Buktikan kehebatanmu sekarang!</h2>

                <div style="background: #FFF8E1; padding: 25px; border-radius: 20px; text-align: left; border: 2px solid #FFE082; margin-bottom: 30px;">
                    <h3 style="margin: 0 0 15px 0; color: #F57F17;">üìú Aturan Main:</h3>
                    <ul style="margin: 0; padding-left: 20px; color: #5d4037; font-size: 1.1rem; line-height: 1.6;">
                        <li>Kamu punya <strong>3 Nyawa</strong> ‚ù§Ô∏è</li>
                        <li>Jawab benar minimal 4 soal dalam satu level untuk mendapatkan <strong>+1 Nyawa</strong>! üéÅ</li>
                        <li>Tes berhenti jika nyawa habis.</li>
                        <li>Kerjakan soal sebaik mungkin!</li>
                    </ul>
                </div>

                <button class="btn" onclick="startGame()">Mulai Sekarang üöÄ</button>
            </div>

            <!-- SCREEN 2: GAME -->
            <div id="gameScreen" class="screen">
                <div class="game-info-header"></div>
                <div class="progress-container">
                    <div class="progress-fill" id="progressBar"></div>
                </div>
                <div class="question-box" id="questionText"></div>
                <div class="options-grid" id="optionsContainer"></div>
            </div>

            <!-- SCREEN 3: RESULT -->
            <div id="resultScreen" class="screen" style="text-align: center;">
                <h1>Tes Selesai! üéâ</h1>
                <p style="font-size: 1.2rem; color: #7f8c8d;">Kerja Bagus!</p>
                <div class="result-card-inner">
                    <div style="font-size: 1rem; opacity: 0.9; text-transform: uppercase; letter-spacing: 2px;">Level Kamu</div>
                    <div class="result-level" id="finalPlacement">MASTERY 1</div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 30px;">
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; border: 2px solid #eee;">
                        <div style="font-size: 2rem; font-weight: 900; color: var(--dark);" id="finalScore">0/60</div>
                        <div style="color: #95a5a6; font-size: 0.9rem; font-weight: 700;">SKOR BENAR</div>
                    </div>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; border: 2px solid #eee;">
                        <div style="font-size: 2rem; font-weight: 900; color: var(--dark);" id="timeUsed">00:00</div>
                        <div style="color: #95a5a6; font-size: 0.9rem; font-weight: 700;">WAKTU</div>
                    </div>
                </div>
                <button class="btn btn-report" onclick="toggleReport()" id="btnReportToggle">üìã Lihat Detail Jawaban Salah</button>
                <button class="btn btn-dashboard" onclick="clearAndReload()" style="background: #e74c3c; border-bottom-color: #c0392b;">üîÑ Reset & Main Lagi</button>
                
                <div id="reportCard" class="report-card">
                    <div class="report-header">
                        <span>Analisis Kesalahan</span>
                        <span style="font-size: 0.8rem; opacity: 0.8;">Untuk Advisor</span>
                    </div>
                    <ul id="reportList" class="report-list"></ul>
                </div>
            </div>
            
            <!-- FEEDBACK AREA -->
            <div class="feedback-container" id="feedbackArea">
                <div class="feedback-msg" id="feedbackMessage">Jawaban Benar!</div>
                <button class="btn btn-next" id="nextBtn" onclick="nextQuestion()">Lanjut ‚ûî</button>
            </div>
            
            <!-- CHECKPOINT MODAL -->
            <div id="checkpointModal" class="checkpoint-overlay">
                <div class="checkpoint-content">
                    <div style="font-size: 4rem; margin-bottom: 10px;">‚≠ê</div>
                    <h2 style="color: var(--primary); font-size: 1.8rem; margin-bottom: 10px;">CHECKPOINT!</h2>
                    <p style="font-size: 1.1rem; color: #555;">Level Selesai!</p>
                    <p id="checkpointMsg" style="color: #27ae60; font-weight: bold; margin: 15px 0;">+1 Nyawa ‚ù§Ô∏è</p>
                    <p style="font-size: 0.9rem; color: #888; margin-bottom: 25px;">Siap untuk tantangan berikutnya?</p>
                    <button class="btn" onclick="closeCheckpoint()">LANJUT KE LEVEL BERIKUTNYA ‚ñ∂</button>
                </div>
            </div>
            
            <div id="bonusNotif" class="life-bonus-notif">
                <div>Level Up!</div>
                <div style="color: #4cd137; margin-top: 5px;">+1 Nyawa ‚ù§Ô∏è</div>
            </div>

        </div>
    </div>
</div>

<!-- SINGLE SCRIPT (LOCAL LOGIC) -->
<script>
    // 1. STATE & LOCAL STORAGE KEY
    const STORAGE_KEY = 'math_champs_local_v2';
    
    let currentQuestionIndex = 0;
    let lives = 3;
    let timerInterval;
    let timeRemaining = 3600; 
    let correctAnswers = 0;
    let isAnswering = true;
    let currentLevelCorrect = 0; // Tracks correct answers in current block of 5
    let wrongAnswers = []; 
    let studentName = "";

    // 2. DATABASE SOAL (60 Soal dari File Baru)
    const questions = [
        // --- Discovery 1 (Soal 1-5) ---
        {
            level: "Discovery 1",
            text: "Perhatikan gambar bola voli dan bola basket di bawah ini.<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_fexpep_4306.png' class='q-img'><br>Pilih pernyataan yang <strong>benar</strong> sesuai gambar di atas:",
            options: ["\\( 4 > 9 \\)", "Bola basket berjumlah 6 bola <strong>lebih banyak</strong> dari jumlah bola voli", "Bola voli berjumlah 5 bola <strong>lebih sedikit</strong> dari jumlah bola basket", "Jumlah bola basket dan bola voli adalah 14", "Jumlah bola basket lebih sedikit dari jumlah bola voli"],
            answer: 2 // C
        },
        {
            level: "Discovery 1",
            text: "15 anak sedang berbaris dalam sebuah antrean untuk membeli es krim. Diketahui ada <strong>9 anak di belakang Ron</strong>. Ron berada pada <strong>urutan keberapa</strong> dari depan?",
            options: ["Ke-5", "Ke-6", "Ke-7", "Ke-8", "Ke-9"],
            answer: 1 // B
        },
        {
            level: "Discovery 1",
            text: "Gambar-gambar di bawah ini menunjukkan contoh ikatan bilangan (<em>number bonds</em>).<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_anvga6_4974.png' class='q-img'><br>Diberikan ikatan bilangan berantai di bawah ini. Berapakah <strong>nilai</strong> dari simbol bintang (\\(\\star\\))?<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_a11kd9_2047.png' class='q-img'>",
            options: ["1", "2", "3", "4", "5"],
            answer: 1 // B
        },
        {
            level: "Discovery 1",
            text: "Perhatikan gambar 4 buah penjepit kertas pada grid satuan di bawah ini.<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_1ubn5q_2922.png' class='q-img'><br>Berapakah <strong>selisih panjang</strong> penjepit terpanjang dengan penjepit terpendek?",
            options: ["2 satuan", "3 satuan", "4 satuan", "5 satuan", "6 satuan"],
            answer: 2 // C
        },
        {
            level: "Discovery 1",
            text: "Di lapangan, jumlah anak laki-laki <strong>5 lebih sedikit</strong> dari jumlah anak perempuan. Setelah 2 anak laki-laki pulang ke rumah, <strong>tersisa 3</strong> anak laki-laki di lapangan.<br><br>Ada <strong>berapa anak perempuan</strong> yang sedang berada di lapangan?",
            options: ["5 anak", "8 anak", "10 anak", "12 anak", "13 anak"],
            answer: 2 // C
        },
        // --- Discovery 2 (Soal 6-10) ---
        {
            level: "Discovery 2",
            text: "Manakah dari pilihan di bawah ini yang memiliki nilai atau jumlah <strong>terbesar</strong>?",
            options: [
                "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_urtpbk_3465.png' class='opt-img'>",
                "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_f3sobk_1201.png' class='opt-img'>",
                "23",
                "1 puluhan, 15 satuan",
                "2 puluhan, 1 satuan"
            ],
            answer: 3 // D
        },
        {
            level: "Discovery 2",
            text: "Joan membeli 3 ekor ikan hias.<br>Robin membeli 2 ekor ikan hias <strong>lebih banyak</strong> dari Joan.<br>Doni membeli 5 ekor ikan hias <strong>lebih banyak</strong> dari Robin.<br><br>Berapa banyak <strong>jumlah total</strong> semua ikan hias milik Joan, Robin, dan Doni?",
            options: ["15 ekor", "16 ekor", "17 ekor", "18 ekor", "20 ekor"],
            answer: 3 // D
        },
        {
            level: "Discovery 2",
            text: "Beni tidur pada pukul 23:00 dan bangun keesokan harinya pada pukul 07:30. <strong>Berapa lama</strong> Beni tertidur?<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_wgydzu_7105.png' class='q-img'>",
            options: ["7 jam", "7 jam 30 menit", "8 jam", "8 jam 30 menit", "9 jam"],
            answer: 3 // D
        },
        {
            level: "Discovery 2",
            text: "Manakah gambar atau simbol yang memiliki arti <strong>berbeda</strong> dari yang lain (Perhatikan konsep pengelompokannya)?",
            options: [
                "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_covtau_4848.png' class='opt-img'>",
                "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_nsafji_6424.png' class='opt-img'>",
                "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_drewgx_9962.png' class='opt-img'>",
                "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_a20nsj_4422.png' class='opt-img'>",
                "\\( 4 \\times 3 = 12 \\)"
            ],
            answer: 0 // A
        },
        {
            level: "Discovery 2",
            text: "Perhatikan data perolehan bintang siswa berikut ini.<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_6hjnfz_2336.png' class='q-img'><br>Berapakah <strong>total poin</strong> yang didapatkan <strong>Evelyn</strong>?",
            options: ["3 poin", "10 poin", "15 poin", "20 poin", "25 poin"],
            answer: 2 // C
        },

        // --- Discovery 3 (Soal 11-15) ---
        {
            level: "Discovery 3",
            text: "Perhatikan dua kelompok blok di bawah ini.<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_m8yxwf_8364.png' class='q-img'><br>Hitunglah <strong>selisih nilai</strong> antara kedua kelompok blok di atas.",
            options: ["126", "136", "146", "236", "246"],
            answer: 1 // B
        },
        {
            level: "Discovery 3",
            text: "Rara memiliki <strong>3 balon lebih banyak</strong> dari Riri. Jumlah semua balon Rara dan Riri adalah <strong>11 balon</strong>.<br><br>Berapa banyak balon yang <strong>dimiliki Rara</strong>?",
            options: ["4 balon", "5 balon", "6 balon", "7 balon", "8 balon"],
            answer: 3 // D
        },
        {
            level: "Discovery 3",
            text: "Tinggi badan kakak adalah 1 meter 36 centimeter.<br>Tinggi badan adik adalah 51 centimeter.<br><br>Berapa <strong>selisih</strong> tinggi badan kakak dan adik?",
            options: ["75 cm", "85 cm", "95 cm", "105 cm", "187 cm"],
            answer: 1 // B
        },
        {
            level: "Discovery 3",
            text: "Perhatikan pola gambar berikut:<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_42rsk7_6010.png' class='q-img'><br>Gambar apakah yang akan muncul pada <strong>urutan ke-20 dan ke-30</strong>?",
            options: [
                "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_vx2vxq_202.png' class='opt-img'>",
                "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_7403fz_1901.png' class='opt-img'>", // Updated Option B image
                "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_shnwi5_7897.png' class='opt-img'>",
                "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_2nqwr3_6.png' class='opt-img'>",
                "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_nbp4oc_6208.png' class='opt-img'>"
            ],
            answer: 1 // B
        },
        {
            level: "Discovery 3",
            text: "Sharon memiliki 25 buah mangga. Sharon membagikan <strong>sebanyak-banyaknya</strong> mangga tersebut kepada 3 adiknya <strong>sama banyak</strong>. Pilih jawaban yang tepat mengenai jumlah buah mangga milik Sharon dan adik-adiknya setelah pembagian.",
            options: [
                "Sharon: 1 mangga, masing-masing adiknya: 8 mangga",
                "Sharon: 2 mangga, masing-masing adiknya: 8 mangga",
                "Sharon: 4 mangga, masing-masing adiknya: 7 mangga",
                "Sharon: 1 mangga, masing-masing adiknya: 3 mangga",
                "Sharon: 7 mangga, masing-masing adiknya: 6 mangga"
            ],
            answer: 0 // A
        },
        // --- Discovery 4 (Soal 16-20) ---
        {
            level: "Discovery 4",
            text: "Manakah gambar yang menunjukkan nilai pecahan yang <strong>berbeda</strong> dari yang lainnya?<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_sfyx5q_6217.png' class='q-img'>",
            options: ["Gambar A", "Gambar B", "Gambar C", "Gambar D", "Gambar E"],
            answer: 3 // D
        },
        {
            level: "Discovery 4",
            text: "Hitunglah <strong>jumlah total</strong> dari kumpulan bilangan pada susunan sarang lebah berikut ini.<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_ftwbr3_4258.png' class='q-img'>",
            options: ["61", "68", "70", "71", "72"],
            answer: 3 // D
        },
        {
            level: "Discovery 4",
            text: "Berapakah <strong>selisih</strong> jumlah <strong>sisi</strong> dengan jumlah <strong>titik sudut</strong> pada sebuah limas segiempat?<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_miyzft_675.png' class='q-img'>",
            options: ["0", "1", "2", "3", "4"],
            answer: 0 // A
        },
        {
            level: "Discovery 4",
            text: "Bilangan yang tepat untuk melengkapi kalimat matematika di bawah ini adalah...<br><br>\\[ 16 + 12 - \\underline{\\hspace{1cm}} + 14 = 35 \\]",
            options: ["5", "6", "7", "8", "9"],
            answer: 2 // C
        },
        {
            level: "Discovery 4",
            text: "Hendro memiliki:<br><ul><li>2 lembar Rp10.000</li><li>3 lembar Rp5.000</li><li>4 lembar Rp2.000</li><li>5 lembar Rp1.000</li></ul><br>Ada berapa banyak cara untuk membayar topi seharga <strong>Rp14.000</strong> dengan <strong>uang pas</strong>?",
            options: ["6 cara", "7 cara", "8 cara", "9 cara", "10 cara"],
            answer: 3 // D
        },

        // --- Exploration 1 (Soal 21-25) ---
        {
            level: "Exploration 1",
            text: "Diberikan 5 angka berikut ini: 6, 1, 8, 3, 9.<br><br>Berapakah bilangan <strong>genap 4 digit terbesar</strong> yang dapat dibentuk dari angka-angka yang diberikan di atas?",
            options: ["9863", "9836", "9638", "9816", "9986"],
            answer: 1 // B
        },
        {
            level: "Exploration 1",
            text: "Tuliskan bilangan yang tepat untuk melengkapi kalimat matematika di bawah ini.<br><br>\\[ 4 \\times 11 + \\_\\_\\_ = 54 \\]",
            options: ["8", "9", "10", "11", "12"],
            answer: 2 // C
        },
        {
            level: "Exploration 1",
            text: "Panjang sebuah jalan raya adalah 2 kilometer 400 meter. Ibu walikota berencana untuk menanamkan pohon dari <strong>satu ujung jalan ke ujung jalan yang lain</strong>. Jika <strong>jarak antar pohon</strong> adalah 300 meter, ada berapa pohon yang ditanam oleh ibu walikota?",
            options: ["7 pohon", "8 pohon", "9 pohon", "10 pohon", "12 pohon"],
            answer: 2 // C
        },
        {
            level: "Exploration 1",
            text: "Tuliskan bilangan yang tepat untuk melengkapi kalimat matematika di bawah ini.<br><br>\\[ 2 \\times 36 : \\_\\_\\_ = 12 \\]",
            options: ["4", "5", "6", "8", "9"],
            answer: 2 // C
        },
        {
            level: "Exploration 1",
            text: "Perhatikan diagram batang (tidak lengkap) di bawah ini.<br><strong>Data Penjualan Laptop Toko iGloo</strong><br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_d8cgnc_5445.png' class='q-img'><br>Diketahui bahwa:<br><ul><li>Laptop yang terjual pada bulan Februari dua kali lebih banyak dibandingkan dengan laptop yang terjual pada bulan Januari.</li><li>Penjualan pada bulan Maret 30 laptop lebih sedikit dari bulan Februari.</li></ul><br>Berapakah <strong>jumlah semua</strong> laptop yang terjual pada bulan Januari sampai Maret?",
            options: ["150", "180", "195", "210", "225"],
            answer: 2 // C
        },
        // --- Exploration 2 (Soal 26-30) ---
        {
            level: "Exploration 2",
            text: "Jumlah penonton konser adalah 4.582 orang. Panitia konser mencatat jumlah penonton konser tersebut dengan <strong>pembulatan ke ratusan terdekat</strong>. Tuliskan lambang bilangan yang dicatat oleh panitia konser.",
            options: ["4.500", "4.580", "4.600", "4.700", "5.000"],
            answer: 2 // C
        },
        {
            level: "Exploration 2",
            text: "Perhatikan gambar di bawah ini.<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_x0ndvk_8478.png' class='q-img'><br>Pilih operasi pecahan yang <strong>tidak sesuai</strong> dengan gambar di atas.",
            options: [
                "\\(\\frac{3}{6} + \\frac{2}{6} = \\frac{5}{6}\\)",
                "\\(\\frac{1}{3} + \\frac{1}{2} = \\frac{5}{6}\\)",
                "\\(\\frac{1}{2} + \\frac{1}{3} = \\frac{5}{6}\\)",
                "\\(\\frac{1}{6} + \\frac{2}{3} = \\frac{5}{6}\\)",
                "\\(\\frac{4}{12} + \\frac{6}{12} = \\frac{10}{12}\\)"
            ],
            answer: 3 // D
        },
        {
            level: "Exploration 2",
            text: "Perhatikan gambar dua persegi di bawah ini.<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_mdffvd_6624.png' class='q-img'><br>Diketahui panjang sisi Persegi B <strong>dua kali lebih panjang</strong> dari sisi Persegi A.<br><br><strong>Luas</strong> Persegi B adalah ___ satuan luas.",
            options: ["18", "27", "36", "45", "81"],
            answer: 2 // C
        },
        {
            level: "Exploration 2",
            text: "Kelas 3A terdiri dari 27 siswa. Jika \\(\\frac{2}{3}\\) dari seluruh kelas adalah penggemar Shakira, berapa siswa kelas 3A yang <strong>bukan penggemar</strong> Shakira?",
            options: ["6 siswa", "9 siswa", "12 siswa", "18 siswa", "21 siswa"],
            answer: 1 // B
        },
        {
            level: "Exploration 2",
            text: "Perhatikan diagram batang di bawah ini.<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_udqk91_9125.png' class='q-img'><br>Berapa <strong>selisih</strong> jumlah pengunjung mal pada hari pengunjung <strong>paling banyak</strong> dengan pada hari pengunjung <strong>paling sedikit</strong>?",
            options: ["200 pengunjung", "240 pengunjung", "280 pengunjung", "300 pengunjung", "320 pengunjung"],
            answer: 2 // C
        },

        // --- Exploration 3 (Soal 31-35) ---
        {
            level: "Exploration 3",
            text: "Aku adalah bilangan <strong>kelipatan 4</strong>. Aku memiliki <strong>5 faktor</strong>. Bilangan apakah aku?",
            options: ["8", "12", "16", "20", "24"],
            answer: 2 // C
        },
        {
            level: "Exploration 3",
            text: "Perhatikan gambar di bawah ini.<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_mrykua_3248.png' class='q-img'><br>Pilih pernyataan yang <strong>TIDAK SESUAI</strong> dengan gambar di atas.",
            options: [
                "\\( 3 \\times 6 = 18 \\)",
                "\\( 3 \\times (2 + 4) = 18 \\)",
                "\\( 3 \\times 2 + 3 \\times 4 = 18 \\)",
                "\\( 5 \\times 3 + 1 \\times 3 = 18 \\)",
                "\\( 3 \\times (4 + 2) = 18 \\)"
            ],
            answer: 3 // D
        },
        {
            level: "Exploration 3",
            text: "Nena membeli kelereng dari dua toko: Toko A dan Toko B.<br><ul><li>Toko A menjual kelereng dalam satuan kodi (20 buah).</li><li>Toko B menjual kelereng dalam satuan lusin (12 buah).</li></ul><br>Nena membeli 3 kodi dari toko A dan 4 lusin dari toko B.<br>Berapa <strong>jumlah kelereng</strong> yang Nena beli?",
            options: ["48 butir", "60 butir", "100 butir", "108 butir", "112 butir"],
            answer: 3 // D
        },
        {
            level: "Exploration 3",
            text: "Perhatikan proses perkalian vertikal di bawah ini.<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_tciz5u_9051.png' class='q-img'><br>Dari pilihan di bawah ini, pilihan mana yang <strong>TIDAK SESUAI</strong> dengan proses perkalian vertikal di atas?",
            options: [
                "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_zyvatm_5236.png' class='opt-img' style='max-height: 200px;'>",
                "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_2ihh7f_7988.png' class='opt-img' style='max-height: 200px;'>",
                "\\( 35 \\times 12 = 70 \\times 6 = 420 \\)",
                "\\( 35 \\times 12 = 35 \\times (10 + 2) = 35 \\times 10 + 35 \\times 2 = 350 + 70 = 420 \\)",
                "\\( 35 \\times 12 = 35 \\times (1 \\text{ puluhan} + 2 \\text{ satuan}) = 35 \\text{ puluhan} + 70 \\text{ satuan} = 420 \\)"
            ],
            answer: 2 // C
        },
        {
            level: "Exploration 3",
            text: "Perhatikan proses pembagian vertikal di bawah ini.<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_vbusm7_752.png' class='q-img'><br>Dari pilihan di bawah ini, pilihan mana yang <strong>TIDAK SESUAI</strong> dengan proses pembagian vertikal di atas?",
            options: [
                "5 ratusan, 5 puluhan, 4 satuan dibagi 4",
                "\\( 552 : 4 = (500 + 50 + 2) : 4 = 500 : 4 + 50 : 4 + 2 : 4 = 400 : 4 + 120 : 4 + 32 : 4 = 100 + 30 + 8 = 138 \\)",
                "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_pjcy5p_2842.png' class='opt-img' style='max-height: 200px;'>",
                "\\( 552 : 4 = 276 : 2 = 138 \\)",
                "\\( \\frac{552}{4} = \frac{500}{4}+\frac{50}{4}+\frac{2}{4}=\frac{400}{4}+\frac{120}{4}+\frac{32}{4}=100+30+8 = 138 \\)"
            ],
            answer: 3 // D
        },
        // --- Exploration 4 (Soal 36-40) ---
        {
            level: "Exploration 4",
            text: "Anne sedang mencari jumlah dari \\(\\frac{1}{2}\\) dan \\(\\frac{1}{3}\\). Langkah pertama yang ia lakukan adalah menyamakan penyebut menjadi 6.<br><br>Pilih alasan yang <strong>TIDAK TEPAT</strong> mengapa Anne melakukan hal tersebut.",
            options: [
                "Penjumlahan dan pengurangan pecahan hanya bisa dikerjakan ketika ukuran potongannya (satuannya) sama.",
                "Sama seperti 1 kodi dan 1 lusin tidak bisa langsung dijumlahkan, 1 perdua dan 1 pertiga juga tidak bisa langsung dijumlahkan.",
                "Cara terbaik untuk menyamakan penyebut adalah dengan selalu mengkalikan penyebut-penyebutnya (\\(2 \\times 3\\)).",
                "Anne memilih bilangan 6 karena 6 adalah Kelipatan Persekutuan Terkecil (KPK) dari 2 dan 3.",
                "Menggunakan KPK bertujuan untuk mendapatkan pecahan yang paling sederhana saat menjumlahkan."
            ],
            answer: 2 // C
        },
        {
            level: "Exploration 4",
            text: "Perhatikan gambar pecahan campuran di bawah ini.<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_lixadg_3523.png' class='q-img'><br>Pilih bentuk penulisan bilangan yang <strong>TIDAK SESUAI</strong> dengan gambar di atas.",
            options: [
                "\\( 2,33... \\)",
                "\\( 2\\frac{1}{3} \\)",
                "\\( \\frac{7}{3} \\)",
                "7 pertiga",
                "\\( 2,33 \\)"
            ],
            answer: 4 // E
        },
        {
            level: "Exploration 4",
            text: "Juno sedang mengukur massa sebungkus jeruk dengan neraca. Neraca seimbang ketika Juno menempatkan:<br><ul><li>2 bandul 1 kg</li><li>1 bandul 500 g</li><li>3 bandul 100 g</li></ul><br>Ada 8 jeruk dalam bungkusan tersebut. Jika massa jeruk dianggap sama, berapa <strong>massa 1 jeruk</strong> dalam satuan kilogram (dibulatkan ke persepuluhan terdekat)?",
            options: ["0,3 kg", "0,35 kg", "0,4 kg", "2,8 kg", "3,5 kg"],
            answer: 2 // C
        },
        {
            level: "Exploration 4",
            text: "Manakah di antara pilihan berikut yang menunjukkan gambar <strong>segitiga tumpul sembarang</strong>?",
            options: [
                "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_mhigra_6610.png' class='opt-img'>",
                "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_ha1iuv_9917.png' class='opt-img'>",
                "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_iuijrs_8047.png' class='opt-img'>",
                "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_onhdj1_7390.png' class='opt-img'>",
                "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_vm49m2_9766.png' class='opt-img'>"
            ],
            answer: 2 // C
        },
        {
            level: "Exploration 4",
            text: "Perhatikan grafik suhu rata-rata harian Kota Zula di bawah ini.<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_a91pqd_2599.png' class='q-img'><br><strong>Kenaikan suhu terbesar</strong> terjadi dari tanggal ...",
            options: ["21 ke 22 Maret", "22 ke 23 Maret", "23 ke 24 Maret", "24 ke 25 Maret", "25 ke 26 Maret"],
            answer: 4 // E
        },

        // --- Mastery 1 (Soal 41-45) ---
        {
            level: "Mastery 1",
            text: "Hitunglah hasil dari operasi bilangan berikut:<br>\\[ 88 \\times 125 - 18 \\times 50 - 24 \\times 25 - 2 \\times 100 = \\dots \\]",
            options: ["9.200", "9.300", "9.400", "10.300", "11.000"],
            answer: 1 // B
        },
        {
            level: "Mastery 1",
            text: "Lina mempunyai \\(3\\frac{1}{4}\\) meter pita merah. Dia membeli lagi \\(2\\frac{2}{3}\\) meter untuk mendekorasi kelasnya. Jika pita yang terpakai adalah \\(4\\frac{5}{6}\\) meter, berapa meter <strong>sisa pita</strong> yang dimiliki Lina?",
            options: ["\\( 1\\frac{1}{12} \\) meter", "\\( 1\\frac{1}{6} \\) meter", "\\( 1\\frac{1}{4} \\) meter", "\\( \\frac{11}{12} \\) meter", "\\( 2\\frac{1}{12} \\) meter"],
            answer: 0 // A
        },
        {
            level: "Mastery 1",
            text: "Diketahui dua buah kubus, Kubus A dan Kubus B. Panjang sisi Kubus B adalah <strong>3 kali panjang sisi</strong> Kubus A. Jika volume Kubus A adalah \\( 5~cm^3 \\), berapakah <strong>volume Kubus B</strong>?<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_hyriw4_786.png' class='q-img'>",
            options: ["\\( 15~cm^3 \\)", "\\( 27~cm^3 \\)", "\\( 45~cm^3 \\)", "\\( 125~cm^3 \\)", "\\( 135~cm^3 \\)"],
            answer: 4 // E
        },
        {
            level: "Mastery 1",
            text: "Ibu membuat sejumlah kue. \\(\\frac{1}{2}\\) dari seluruh kue diberikan kepada nenek. \\(\\frac{2}{3}\\) dari <strong><em>sisanya</em></strong> diberikan kepada bibi. Jika jumlah kue yang tersisa sekarang adalah 5 buah, berapakah jumlah kue yang ibu buat <strong>mula-mula</strong>?",
            options: ["15 kue", "20 kue", "25 kue", "30 kue", "45 kue"],
            answer: 3 // D
        },
        {
            level: "Mastery 1",
            text: "Di antara pilihan kecepatan berikut, manakah yang nilainya <strong>berbeda</strong> dari yang lain?",
            options: ["60 km/jam", "1 km/menit", "\\( 16\\frac{2}{3} \\) m/detik", "1.000 km/menit", "1.000 m/menit"],
            answer: 3 // D
        },
        // --- Mastery 2 (Soal 46-50) ---
        {
            level: "Mastery 2",
            text: "Hitunglah hasil dari: \\[ 20 - 12 : 4 + 3 \\times 2 = \\dots \\]",
            options: ["8", "10", "14", "23", "26"],
            answer: 3 // D
        },
        {
            level: "Mastery 2",
            text: "Ali membelanjakan uangnya <strong>5 kali lebih banyak</strong> daripada Baba di sebuah toko. Ali membayar dengan selembar uang Rp20.000 dan menerima kembalian Rp2.000. Berapa banyak <strong>uang yang dibelanjakan Baba</strong>?",
            options: ["Rp3.000", "Rp3.500", "Rp3.600", "Rp4.000", "Rp4.500"],
            answer: 2 // C
        },
        {
            level: "Mastery 2",
            text: "Perhatikan gambar bangun datar dengan dimensi berikut. Manakah di antara bangun berikut yang memiliki <strong>luas yang berbeda</strong> dari yang lain?",
            options: [
                "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_ccaldw_5137.png' class='opt-img'>",
                "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_5kmrmc_4024.png' class='opt-img'>",
                "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_yqgteq_2623.png' class='opt-img'>",
                "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_ew6pym_1651.png' class='opt-img'>",
                "<img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_6jlqrw_5151.png' class='opt-img'>"
            ],
            answer: 2 // C
        },
        {
            level: "Mastery 2",
            text: "Sebuah bak mandi berbentuk balok akan terisi penuh dengan 450 liter air. Jika panjang bak mandi adalah 1 meter dan lebarnya 60 cm, berapakah <strong>tinggi bak mandi</strong> tersebut?",
            options: ["7,5 cm", "75 cm", "80 cm", "0,75 cm", "7,5 meter"],
            answer: 1 // B
        },
        {
            level: "Mastery 2",
            text: "Tabel di bawah ini menunjukkan nilai ujian akhir matematika dari 5 orang siswa.<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_bdwoas_1258.png' class='q-img'><br>Ada berapa anak yang nilainya <strong>di atas rata-rata</strong> dari kelima siswa tersebut?",
            options: ["1 anak", "2 anak", "3 anak", "4 anak", "5 anak"],
            answer: 2 // C
        },

        // --- Mastery 3 (Soal 51-55) ---
        {
            level: "Mastery 3",
            text: "Diketahui:<br>\\[ A : B = 5 : 6 \\]<br>\\[ B : C = 3 : 8 \\]<br>\\[ C - A = 3 \\]<br>Cari nilai \\( B + C \\)",
            options: ["6", "12", "18", "22", "24"],
            answer: 0 // A
        },
        {
            level: "Mastery 3",
            text: "\\(\\frac{1}{3}\\) uang Andi sama dengan \\(\\frac{2}{5}\\) uang Budi. Jika <strong>selisih uang</strong> mereka Rp5.000, berapa <strong>total uang</strong> keduanya?",
            options: ["Rp45.000,00", "Rp50.000,00", "Rp55.000,00", "Rp60.000,00", "Rp65.000,00"],
            answer: 2 // C
        },
        {
            level: "Mastery 3",
            text: "Sebuah segitiga sama kaki memiliki dua sudut yang sama besar dan satu sudut lain yang berbeda. Sudut yang berbeda itu merupakan <strong>sudut terbesar</strong> segitiga dan besarnya \\(70^{\\circ}\\). Berapakah hasil <strong>penjumlahan kedua sudut yang lain</strong>?",
            options: ["\\(70^\\circ\\)", "\\(100^\\circ\\)", "\\(110^\\circ\\)", "\\(140^\\circ\\)", "\\(180^\\circ\\)"],
            answer: 2 // C
        },
        {
            level: "Mastery 3",
            text: "Harga mainan kesukaan kakak <strong>naik 20%</strong> dibandingkan dengan harga sebelumnya. Jika harga sekarang adalah Rp72.000, berapa harga mainan tersebut <strong>sebelum mengalami kenaikan</strong>?",
            options: ["Rp57.600,00", "Rp60.000,00", "Rp62.000,00", "Rp64.000,00", "Rp68.000,00"],
            answer: 1 // B
        },
        {
            level: "Mastery 3",
            text: "Rata-rata dari 4 bilangan adalah 9. Jika salah satu bilangan dibuang, rata-ratanya menjadi 8. Berapakah <strong>bilangan yang dibuang</strong> tersebut?",
            options: ["9", "10", "11", "12", "13"],
            answer: 3 // D
        },
        // --- Mastery 4 (Soal 56-60) ---
        {
            level: "Mastery 4",
            text: "Perhatikan gambar di bawah ini.<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_a5fnos_7001.png' class='q-img'><br>Tentukan operasi pecahan yang sedang diilustrasikan oleh gambar di atas.",
            options: [
                "\\(\\frac{2}{3}+\\frac{1}{3}=1\\)",
                "\\(\\frac{8}{15}+\\frac{7}{15}=1\\)",
                "\\(\\frac{4}{5}\\times\\frac{2}{3}=\\frac{8}{15}\\)",
                "\\(2\\times\\frac{4}{15}=\\frac{8}{15}\\)",
                "\\(\\frac{4}{5}+\\frac{2}{3}=\\frac{22}{15}\\)"
            ],
            answer: 2 // C
        },
        {
            level: "Mastery 4",
            text: "Merisa menggunakan \\(\\frac{3}{4}\\) uangnya untuk membeli sebuah buku. Kemudian, ia menggunakan \\(\\frac{1}{2}\\) <strong>dari sisanya</strong> untuk membeli sebuah kalkulator. Jika <strong>harga buku</strong> Rp30.000 lebih mahal dari harga kalkulator, berapakah harga buku tersebut?",
            options: ["Rp30.000,00", "Rp36.000,00", "Rp42.000,00", "Rp48.000,00", "Rp54.000,00"],
            answer: 1 // B
        },
        {
            level: "Mastery 4",
            text: "Perhatikan gambar di bawah ini.<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_lwxdzu_2359.png' class='q-img'><br>Gambar di atas terbentuk dari sebuah persegi dengan panjang sisi 10 cm dan seperempat lingkaran. Berapakah <strong>luas daerah yang diarsir</strong>? Gunakan pendekatan \\(\\Pi\\approx3,14\\).",
            options: ["21,5 cm¬≤", "31,4 cm¬≤", "50 cm¬≤", "78,5 cm¬≤", "100 cm¬≤"],
            answer: 0 // A
        },
        {
            level: "Mastery 4",
            text: "Pada pk. 07.00, seorang anak bersepeda dari rumah ke perpustakaan dengan kecepatan \\(18~km/jam.\\) Setelah 20 menit berselang, ibunya menyusul dengan sepeda listrik dengan kecepatan \\(24~km/jam.\\) Jika jalan dari rumah ke perpustakaan lurus dan kecepatan mereka konstan, pada <strong>pukul berapa</strong> ibu tersebut akan <strong>menyusul</strong> anaknya?",
            options: ["08.00", "08.10", "08.20", "08.30", "08.40"],
            answer: 2 // C
        },
        {
            level: "Mastery 4",
            text: "Pada suatu kelas olahraga, diketahui 24% peserta mengikuti permainan voli. Sudut pembentuk juring bertuliskan SEPAKBOLA pada diagram lingkaran adalah 144¬∞. Jika jumlah seluruh peserta kelas olahraga adalah 50 orang, berapa <strong>peserta yang mengikuti permainan basket</strong>?<br><img src='https://imgix3.ruangguru.com/assets/miscellaneous/png_tc8mcb_2669.png' class='q-img'>",
            options: ["12 Siswa", "15 Siswa", "18 Siswa", "20 Siswa", "24 Siswa"],
            answer: 2 // C
        }
    ];

    // --- FUNCTION DEFINITIONS ---

    window.onload = function() {
        loadState();
    };

    function saveState() {
        const state = {
            studentName,
            currentQuestionIndex,
            lives,
            wrongAnswers,
            timeRemaining,
            currentLevelCorrect
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function loadState() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) {
            const state = JSON.parse(saved);
            // Only restore if user hasn't finished (lives > 0 and index < length)
            if (state.lives > 0 && state.currentQuestionIndex < questions.length && state.studentName) {
                studentName = state.studentName;
                currentQuestionIndex = state.currentQuestionIndex;
                lives = state.lives;
                wrongAnswers = state.wrongAnswers || [];
                timeRemaining = state.timeRemaining || 3600;
                currentLevelCorrect = state.currentLevelCorrect || 0;
                
                inputNameScreen.classList.remove('active');
                gameScreen.classList.add('active');
                statusBar.style.visibility = 'visible';
                updateStats();
                loadQuestion();
                
                if (timerInterval) clearInterval(timerInterval);
                timerInterval = setInterval(() => {
                    timeRemaining--;
                    if (timeRemaining <= 0) endGame(false, true);
                    if (timeRemaining % 10 === 0) saveState(); // Periodic save
                }, 1000);
            }
        }
    }

    window.clearAndReload = function() {
        localStorage.removeItem(STORAGE_KEY);
        location.reload();
    };

    window.saveNameAndContinue = function() {
        const name = document.getElementById('studentNameInput').value.trim();
        
        if (name) {
            studentName = name;
            inputNameScreen.classList.remove('active');
            startScreen.classList.add('active');
            saveState();
        } else {
            alert("Silakan masukkan nama kamu.");
        }
    };

    window.startGame = function() {
        startScreen.classList.remove('active');
        gameScreen.classList.add('active');
        statusBar.style.visibility = 'visible';
        
        currentQuestionIndex = 0;
        lives = 3;
        correctAnswers = 0;
        currentLevelCorrect = 0;
        timeRemaining = 3600;
        wrongAnswers = [];
        
        feedbackArea.style.display = 'none';
        updateStats();
        
        if (timerInterval) clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            timeRemaining--;
            if (timeRemaining <= 0) endGame(false, true);
            if (timeRemaining % 5 === 0) saveState(); // Save every 5s just in case
        }, 1000);
        
        loadQuestion();
        saveState();
    };

    window.nextQuestion = function() {
        currentQuestionIndex++;
        loadQuestion();
        saveState();
    };
    
    window.toggleReport = function() {
        if (reportCard.style.display === 'block') {
            reportCard.style.display = 'none';
            btnReportToggle.innerText = 'üìã Lihat Detail Jawaban Salah';
        } else {
            reportCard.style.display = 'block';
            btnReportToggle.innerText = 'üîº Tutup Detail';
            setTimeout(() => {
                reportCard.scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }
    };

    window.closeCheckpoint = function() {
        checkpointModal.style.display = 'none';
        lifeContainer.classList.remove('pulse-green');
        window.nextQuestion();
    };

    // --- HELPER FUNCTIONS ---

    function updateStats() {
        if(livesDisplay) livesDisplay.innerText = lives;
        const totalQ = 60; 
        const progress = ((currentQuestionIndex) / totalQ) * 100;
        if(progressBar) progressBar.style.width = `${progress}%`;
    }

    function loadQuestion() {
        feedbackArea.style.display = 'none';
        isAnswering = true;
        
        if (currentQuestionIndex >= questions.length) { 
            // if we run out of questions but logic is good, end game as finished
            endGame(true); 
            return;
        }

        const q = questions[currentQuestionIndex];
        
        // Safety check if q is undefined (in case index goes out of bounds)
        if(!q) { endGame(true); return; }

        questionText.innerHTML = q.text;
        optionsContainer.innerHTML = '';
        
        optionsContainer.style.gridTemplateColumns = (window.innerWidth > 600 && q.options.length !== 5) ? "repeat(2, 1fr)" : "1fr";

        q.options.forEach((opt, index) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerHTML = opt;
            btn.onclick = () => checkAnswer(index, btn);
            optionsContainer.appendChild(btn);
        });

        if(window.renderMathInElement) {
             renderMathInElement(gameScreen, { delimiters: [
                 {left: '$$', right: '$$', display: true}, 
                 {left: '$', right: '$', display: false},
                 {left: '\\(', right: '\\)', display: false},
                 {left: '\\[', right: '\\]', display: true}
             ]});
        }
        
        if(window.innerWidth < 768) window.scrollTo({top:0, behavior:'smooth'});
        else document.querySelector('.game-stage').scrollTo({top:0, behavior:'smooth'});
    }

    function checkAnswer(selectedIndex, btnElement) {
        if (!isAnswering) return; 
        isAnswering = false;
        const q = questions[currentQuestionIndex];
        
        document.querySelectorAll('.option-btn').forEach(b => b.disabled = true);

        if (selectedIndex === q.answer) {
            btnElement.classList.add('correct');
            feedbackMessage.innerText = "Yey! Benar! üéâ";
            feedbackMessage.style.color = "#27ae60";
            correctAnswers++;
            currentLevelCorrect++;
            nextBtn.onclick = handleLevelTransition;
            nextBtn.style.display = 'block';
        } else {
            btnElement.classList.add('wrong');
            lives--;
            updateStats();
            
            wrongAnswers.push({
                index: currentQuestionIndex + 1,
                level: q.level,
                text: q.text,
                options: q.options,
                userIndex: selectedIndex,
                correctIndex: q.answer,
                isFiveOpts: q.options.length === 5
            });

            if (lives <= 0) {
                feedbackMessage.innerText = "Yah, Nyawa Habis üíî";
                feedbackMessage.style.color = "#c0392b";
                nextBtn.style.display = 'none';
                setTimeout(() => endGame(false), 2000);
            } else {
                feedbackMessage.innerText = "Ups, Masih Salah üòî";
                feedbackMessage.style.color = "#c0392b";
                nextBtn.onclick = handleLevelTransition;
                nextBtn.style.display = 'block';
            }
        }
        feedbackArea.style.display = 'flex';
        saveState();
    }

    function handleLevelTransition() {
        // Check if we are at the end of a level block (index 9, 19, 29, etc. since 10 questions per part)
        // (index + 1) is divisible by 10 (Use 10 for Bagian 1-6 logic, but the code originally used 5)
        // Adjusting to original request logic: keep the +1 life mechanism every 5 questions?
        // Or adapt to the new "Bagian" structure (10 questions).
        // Let's stick to the original logic: "Jawab benar minimal 4 soal dalam satu level".
        // The original logic checked every 5 questions.
        // To be safe and generous, I will keep the check every 5 questions so students get lives more often.
        
        if ((currentQuestionIndex + 1) % 5 === 0) {
            let gotBonus = false;
            let bonusText = "Level Selesai!";
            
            // Logic: if correct >= 4 in this block of 5, add +1 life (max 3)
            if (currentLevelCorrect >= 4) {
                if (lives < 3) { 
                    lives++; 
                    gotBonus = true; 
                    bonusText = "Hebat! +1 Nyawa ‚ù§Ô∏è"; 
                } else { 
                    bonusText = "Sempurna! ‚ù§Ô∏è"; 
                }
            } else {
                bonusText = "Lanjut ke Soal Berikutnya";
            }
            
            // Show Checkpoint
            checkpointMsg.innerText = bonusText;
            checkpointMsg.style.color = gotBonus ? "#27ae60" : "#f39c12";
            if(gotBonus) lifeContainer.classList.add('pulse-green');
            
            checkpointModal.style.display = 'flex';
            updateStats();
            
            // Reset tracking for next block
            currentLevelCorrect = 0;
            saveState();
        } else {
            // Not end of block, just go next
            window.nextQuestion();
        }
    }

    function endGame(completed = false) {
        clearInterval(timerInterval);
        gameScreen.classList.remove('active');
        resultScreen.classList.add('active');
        statusBar.style.visibility = 'hidden';
        
        // Determine level based on where they stopped
        let finalLevel = "Placement Test";
        if (completed) {
            finalLevel = "COMPLETED ALL 60 QUESTIONS";
        } else {
            // If stopped at index 7, level is Bagian 1.
            if (questions[currentQuestionIndex]) {
                finalLevel = questions[currentQuestionIndex].level;
            } else if (questions[currentQuestionIndex-1]) {
                finalLevel = questions[currentQuestionIndex-1].level;
            }
        }
        
        let timeUsed = 3600 - timeRemaining;
        let m = Math.floor(timeUsed / 60);
        let s = timeUsed % 60;
        let timeString = `${m < 10 ? '0'+m : m}:${s < 10 ? '0'+s : s}`;

        document.getElementById('finalPlacement').innerText = finalLevel.toUpperCase();
        document.getElementById('finalScore').innerText = `${correctAnswers}/60`;
        document.getElementById('timeUsed').innerText = timeString;
        
        generateReportCard();
        localStorage.removeItem(STORAGE_KEY); 
    }

    function generateReportCard() {
        reportList.innerHTML = '';
        if (wrongAnswers.length === 0) {
            reportList.innerHTML = '<li class="report-item" style="text-align:center; color:#27ae60;">Luar biasa! Tidak ada kesalahan. üéâ</li>';
            return;
        }
        
        wrongAnswers.forEach(item => {
            const li = document.createElement('li');
            li.className = 'report-item';
            
            let gridHtml = `<div class="report-grid" style="${item.isFiveOpts ? 'grid-template-columns: 1fr;' : ''}">`;
            
            item.options.forEach((opt, idx) => {
                let statusClass = '';
                if (idx === item.correctIndex) statusClass = 'correct';
                else if (idx === item.userIndex) statusClass = 'wrong';
                
                gridHtml += `
                    <div class="option-btn report-variant ${statusClass}">
                        ${opt}
                    </div>
                `;
            });
            gridHtml += `</div>`;

            li.innerHTML = `
                <div class="report-meta">Soal ${item.index} ‚Ä¢ ${item.level}</div>
                <div class="report-q-text">${item.text}</div>
                ${gridHtml}
            `;
            reportList.appendChild(li);
        });
        
        if(window.renderMathInElement) {
            renderMathInElement(reportList, {
                delimiters: [
                 {left: '$$', right: '$$', display: true}, 
                 {left: '$', right: '$', display: false},
                 {left: '\\(', right: '\\)', display: false},
                 {left: '\\[', right: '\\]', display: true}
             ]});
        }
    }

</script>
</body>
</html>
